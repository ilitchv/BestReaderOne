# Generate improved HTML v5 based on feedback:
# - Revert to richer OCR UI (multi-line table, raw text preview, Save All) from v3
# - Move ALL controls (language/theme toggles, search, auto-scroll) into hidden Admin panel
# - Slow down auto-scroll considerably
# - Remove left filter panel; main page now only shows sections and tiles
# - Fix overlap: place status label within meta area (not absolute)
# - Keep TX Sunday off, TN Sunday Only Evening; include Special "3-5-7"
# - Keep neon theme and compact square tiles
# Save to /mnt/data/beast_reader_v5.html

html = r"""<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Beast Reader ‚Äî Resultados de Loter√≠as</title>
<style>
  :root{
    --bg:#0a0b10;
    --card:#10142a;
    --text:#e7f0ff;
    --muted:#a8b3d8;
    --accent1:#5df6ff;
    --accent2:#8a5dff;
    --accent3:#18ffb2;
    --danger:#ff4d6d;
    --ok:#1be7a8;
    --tile:160px;
    --ring:0 0 12px rgba(93,246,255,.28), 0 0 24px rgba(138,93,255,.18);
  }
  [data-theme="light"]{
    --bg:#f7f8ff;
    --card:#ffffff;
    --text:#0b1020;
    --muted:#4a5578;
    --accent1:#00a3ff;
    --accent2:#6a40ff;
    --accent3:#00c07a;
    --danger:#d7003a;
    --ok:#07a87e;
  }
  html,body{height:100%}
  body{
    margin:0;background: radial-gradient(1200px 1200px at 10% -10%, rgba(93,246,255,.10), transparent 60%),
                         radial-gradient(900px 900px at 110% 10%, rgba(138,93,255,.12), transparent 60%),
                         var(--bg);
    color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }
  header{
    position:sticky;top:0;z-index:50;
    backdrop-filter: blur(10px);
    background: linear-gradient(180deg, rgba(10,11,16,.85), rgba(10,11,16,.55)); border-bottom:1px solid rgba(141,160,255,.15);
  }
  [data-theme="light"] header{background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));}
  .wrap{max-width:1200px;margin:0 auto;padding:14px 18px;display:flex;gap:14px;align-items:center}
  .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
  .logo svg{width:40px;height:40px;filter: drop-shadow(0 0 12px rgba(93,246,255,.5));}
  .logo h1{font-size:clamp(18px,3.2vw,28px);margin:0;letter-spacing:.5px}
  .sub{font-size:12px;color:var(--muted)}
  /* Admin Tab + Panel */
  .admin-tab{
    position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:60;
    background:linear-gradient(180deg, var(--accent2), var(--accent1));color:#031018;
    padding:8px 10px;border-top-right-radius:12px;border-bottom-right-radius:12px;
    font-weight:800;cursor:pointer;box-shadow:var(--ring);user-select:none
  }
  .admin {position:fixed;left:-380px;top:0;bottom:0;width:360px;z-index:70;
    backdrop-filter: blur(12px);
    background: linear-gradient(180deg, rgba(6,10,22,.92), rgba(10,22,22,.92));
    border-right:1px solid rgba(141,160,255,.15);transition:left .25s ease}
  [data-theme="light"] .admin{background:linear-gradient(180deg, rgba(250,250,255,.95), rgba(245,245,255,.95))}
  .admin.open{left:0}
  .admin .head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(141,160,255,.15)}
  .admin .body{padding:12px;overflow:auto;height:calc(100% - 56px)}
  .btn{background:linear-gradient(135deg, var(--accent1), var(--accent2));color:#06121b;border:0;padding:9px 12px;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:var(--ring)}
  .ghost{background:transparent;border:1px solid rgba(141,160,255,.3);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
  .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .switch{position:relative;width:46px;height:26px;border-radius:999px;background:#2a325a;cursor:pointer}
  .knob{position:absolute;height:22px;width:22px;border-radius:50%;background:white;top:2px;left:2px;transition:.25s}
  input[type="checkbox"]{display:none}
  input[type="checkbox"]:checked + .switch .knob{left:22px}
  input[type="text"], input[type="password"], select, textarea {background:#0e1424;color:var(--text);border:1px solid rgba(141,160,255,.25);border-radius:10px;padding:8px 10px;width:100%}
  [data-theme="light"] input[type="text"],[data-theme="light"] input[type="password"],[data-theme="light"] select,[data-theme="light"] textarea{background:#fff;color:#111}
  .ocr-drop{border:1px dashed rgba(141,160,255,.35);padding:12px;border-radius:10px;text-align:center}
  .ocr-drop.drag{background:rgba(93,246,255,.08)}
  .ocr-wrap{border:1px dashed rgba(141,160,255,.25);border-radius:10px;padding:8px}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid rgba(141,160,255,.2);padding:6px;font-size:12px}
  /* Layout main */
  main{max-width:1200px;margin:18px auto 64px;padding:0 14px}
  .section{margin-bottom:18px}
  .section h2{margin:0 0 12px 0;font-size:18px}
  .grid{display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--tile), 1fr));gap:12px}
  .tile{position:relative;background:linear-gradient(135deg, rgba(93,246,255,.08), rgba(138,93,255,.08));border:1px solid rgba(141,160,255,.25);border-radius:14px;padding:10px;
        aspect-ratio: 1 / 1.05;display:flex;flex-direction:column;justify-content:space-between;box-shadow:var(--ring);overflow:hidden}
  .badge{display:flex;align-items:center;gap:6px;font-weight:800}
  .emblem{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent1),var(--accent3));display:grid;place-items:center;color:#001018;
          font-size:14px;font-weight:900;box-shadow:0 0 16px rgba(93,246,255,.5)}
  .name{font-size:13px;color:var(--muted)}
  .pill{font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:#cbd5e1;margin-left:auto}
  .nums{font-size:22px;letter-spacing:2px;font-weight:900}
  .meta{display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:10px;color:var(--muted);align-items:center}
  .status{font-size:10px;padding:2px 6px;border-radius:999px;justify-self:start;background:rgba(24,255,178,.15);color:#00df9a;border:1px solid rgba(24,255,178,.35)}
  .status.closed{background:rgba(255,77,109,.12);color:#ff6682;border-color:rgba(255,77,109,.35)}
  /* PIN modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55);z-index:80}
  .modal.open{display:grid}
  .card{width:min(420px, 92vw);background:var(--card);border-radius:12px;border:1px solid rgba(141,160,255,.25);box-shadow:var(--ring);padding:12px}
  .eye{cursor:pointer;user-select:none;font-size:18px;padding:6px}
</style>
</head>
<body data-theme="dark">
  <!-- Admin open tab -->
  <div class="admin-tab" id="adminTab">ADMIN</div>
  <!-- Admin Panel -->
  <div class="admin" id="adminPanel" aria-hidden="true">
    <div class="head">
      <strong>Admin</strong>
      <button class="btn" id="closeAdmin">√ó</button>
    </div>
    <div class="body">
      <div class="field">
        <label>Preferencias</label>
        <div class="row">
          <div class="row">
            <span>Idioma</span>
            <input id="langTgl" type="checkbox"/><div class="switch"><div class="knob"></div></div>
          </div>
          <div class="row" style="margin-left:12px">
            <span>Tema</span>
            <input id="themeTgl" type="checkbox"/><div class="switch"><div class="knob"></div></div>
          </div>
          <button class="ghost" id="autoScrollBtn">Auto Scroll</button>
        </div>
      </div>
      <div class="field">
        <label>Buscar loter√≠a</label>
        <input id="search" placeholder="Buscar..." />
      </div>
      <hr style="border-color:rgba(141,160,255,.2)">
      <!-- OCR -->
      <div class="field">
        <label>OCR ‚Äî Arrastra imagen o haz clic</label>
        <div id="drop" class="ocr-drop">Suelta tu captura (.jpg/.png) aqu√≠ <input type="file" id="file" accept="image/*" hidden/></div>
      </div>
      <div class="field">
        <label>Contenido OCR (bruto)</label>
        <textarea id="ocrOut" rows="6" class="ocr-wrap" placeholder="Aqu√≠ aparecer√° el texto detectado..."></textarea>
        <div class="row">
          <button class="ghost" id="btnParse">Previsualizar tabla</button>
          <button class="btn" id="btnAssignAll">Guardar todos</button>
        </div>
      </div>
      <div class="field">
        <div id="ocrTable" class="ocr-wrap"></div>
      </div>
      <hr style="border-color:rgba(141,160,255,.2)">
      <div class="field">
        <label>Agregar/Editar resultado manual</label>
        <div class="row">
          <select id="catalogSelect"></select>
          <select id="drawSelect"></select>
        </div>
        <div class="row">
          <input id="resultInput" placeholder="Ej: 123-4567 (USA) o 12-34-56 (RD/Special)"/>
          <button class="btn" id="saveManual">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PIN Modal -->
  <div class="modal" id="pinModal">
    <div class="card">
      <h3 id="pinTitle">Acceso administrador</h3>
      <div class="field">
        <label id="pinLabel">Introduce PIN</label>
        <div class="row">
          <input id="pinInput" type="password" inputmode="numeric" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
          <span id="toggleEye" class="eye" title="Mostrar/Ocultar">üëÅÔ∏è</span>
          <button class="btn" id="pinOk">Entrar</button>
        </div>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap">
      <a class="logo" href="#">
        <!-- Neon Beast logo -->
        <svg viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#5df6ff"/><stop offset="1" stop-color="#8a5dff"/>
            </linearGradient>
          </defs>
          <rect x="4" y="4" width="64" height="64" rx="14" fill="url(#g1)"/>
          <circle cx="26" cy="28" r="5" fill="#001219"/><circle cx="46" cy="28" r="5" fill="#001219"/>
          <path d="M18 46c10-2 22-12 18-22-3 8 8 14 19 11-4 12-18 19-37 11z" fill="#001219" opacity=".85"/>
        </svg>
        <div>
          <h1>Beast Reader</h1>
          <div class="sub" id="subTitle">Resultados en vivo ‚Äî USA, RD & Special</div>
        </div>
      </a>
    </div>
  </header>

  <main id="content">
    <!-- Sections appear here -->
  </main>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script>
  /*************** I18N ***************/
  const i18n = {
    es: {
      usa: "Loter√≠as de USA",
      rd: "Loter√≠as de Santo Domingo",
      special: "Loter√≠as Special",
      open: "Abierta", closed: "Cerrada",
      draw: "Sorteo", close: "Cierre",
      save: "Guardar", saveAll: "Guardar todos",
      abbr: "Abrev.", map: "Mapa", detected:"Detectado", value:"Valor", actions:"Acciones",
      adminAccess: "Acceso administrador", enterPin: "Introduce PIN", enter:"Entrar",
      ocrRaw:"Contenido OCR (bruto)", ocrTable:"Previsualizaci√≥n"
    },
    en: {
      usa: "USA Lotteries",
      rd: "Santo Domingo Lotteries",
      special: "Special Lotteries",
      open: "Open", closed: "Closed",
      draw: "Draw", close: "Close",
      save: "Save", saveAll: "Save all",
      abbr: "Abbrev.", map: "Map", detected:"Detected", value:"Value", actions:"Actions",
      adminAccess: "Admin access", enterPin: "Enter PIN", enter:"Enter",
      ocrRaw:"OCR raw text", ocrTable:"Preview"
    }
  };
  let lang = localStorage.getItem("lang") || "es";
  function applyLang(){
    document.getElementById("subTitle").textContent = lang==="es" ? "Resultados en vivo ‚Äî USA, RD & Special" : "Live results ‚Äî USA, RD & Special";
    document.getElementById("pinTitle").textContent = i18n[lang].adminAccess;
    document.getElementById("pinLabel").textContent = i18n[lang].enterPin;
    document.getElementById("pinOk").textContent = i18n[lang].enter;
    render();
  }

  /*************** THEME ***************/
  const savedTheme = localStorage.getItem("theme") || "dark";
  document.body.setAttribute("data-theme", savedTheme);

  /*************** ADMIN PIN ***************/
  const ADMIN_PIN = "1983";
  const adminTab = document.getElementById("adminTab");
  const adminPanel = document.getElementById("adminPanel");
  const pinModal = document.getElementById("pinModal");
  const pinInput = document.getElementById("pinInput");
  const pinOk = document.getElementById("pinOk");
  const toggleEye = document.getElementById("toggleEye");
  adminTab.addEventListener("click",()=>{pinModal.classList.add("open"); pinInput.value=""; pinInput.type="password";});
  document.getElementById("closeAdmin").addEventListener("click",()=>adminPanel.classList.remove("open"));
  pinOk.addEventListener("click",()=>{
    if(pinInput.value===ADMIN_PIN){ pinModal.classList.remove("open"); adminPanel.classList.add("open"); }
    else { pinInput.style.borderColor="var(--danger)"; setTimeout(()=>pinInput.style.borderColor="",600); }
  });
  toggleEye.addEventListener("click",()=>{ pinInput.type = pinInput.type==="password"?"text":"password"; });
  pinModal.addEventListener("click",e=>{ if(e.target===pinModal) pinModal.classList.remove("open"); });

  /*************** AUTO SCROLL (MUY LENTO) ***************/
  let scrollTimer=null, scrollDown=true;
  const autoBtn = document.getElementById("autoScrollBtn");
  if(autoBtn){
    autoBtn.addEventListener("click",()=>{
      if(scrollTimer){ clearInterval(scrollTimer); scrollTimer=null; autoBtn.textContent="Auto Scroll"; return; }
      autoBtn.textContent="Detener Scroll";
      const area = document.scrollingElement;
      scrollTimer = setInterval(()=>{
        const step = 0.2; // MUY lento
        area.scrollBy(0, scrollDown?step:-step);
        if(area.scrollTop + window.innerHeight + 2 >= area.scrollHeight){ scrollDown=false; }
        if(area.scrollTop<=1){ scrollDown=true; }
      }, 20);
    });
  }

  /*************** PREFERENCIAS EN ADMIN ***************/
  const themeTgl = document.getElementById("themeTgl");
  const langTgl  = document.getElementById("langTgl");
  if(themeTgl){
    themeTgl.checked = savedTheme==="light";
    themeTgl.addEventListener("change", e=>{
      const th = e.target.checked?"light":"dark";
      document.body.setAttribute("data-theme", th);
      localStorage.setItem("theme", th);
    });
  }
  if(langTgl){
    langTgl.checked = (lang==="en");
    langTgl.addEventListener("change", e=>{
      lang = e.target.checked?"en":"es"; localStorage.setItem("lang", lang); applyLang();
    });
  }

  /*************** CATALOG + SCHEDULES ***************/
  function minus20(timeStr){
    const [H,M]=timeStr.split(":").map(Number);
    const d=new Date(); d.setHours(H,M,0,0); d.setMinutes(d.getMinutes()-20);
    return d.toTimeString().slice(0,5);
  }
  const ALL=[0,1,2,3,4,5,6], MON_SAT=[1,2,3,4,5,6];

  const catalog = {
    usa: [
      { id:"ny", name:"New York", emblem:"NY", tz:"ET",
        draws:[{code:"Midday",time:"14:30",days:ALL},{code:"Evening",time:"22:30",days:ALL}] },
      { id:"nj", name:"New Jersey", emblem:"NJ", tz:"ET",
        draws:[{code:"Midday",time:"12:59",days:ALL},{code:"Evening",time:"22:57",days:ALL}] },
      { id:"ct", name:"Connecticut", emblem:"CT", tz:"ET",
        draws:[{code:"Day",time:"13:57",days:ALL},{code:"Night",time:"22:29",days:ALL}] },
      { id:"fl", name:"Florida", emblem:"FL", tz:"ET",
        draws:[{code:"Midday",time:"13:30",days:ALL},{code:"Evening",time:"21:45",days:ALL}] },
      { id:"ga", name:"Georgia", emblem:"GA", tz:"ET",
        draws:[{code:"Midday",time:"12:29",days:ALL},{code:"Evening",time:"18:59",days:ALL},{code:"Night",time:"23:34",days:ALL}] },
      { id:"pa", name:"Pennsylvania", emblem:"PA", tz:"ET",
        draws:[{code:"Day",time:"13:35",days:ALL},{code:"Evening",time:"18:59",days:ALL}] },
      { id:"de", name:"Delaware", emblem:"DE", tz:"ET",
        draws:[{code:"Day",time:"13:58",days:ALL},{code:"Night",time:"19:57",days:ALL}] },
      { id:"md", name:"Maryland", emblem:"MD", tz:"ET",
        draws:[{code:"Midday",time:"12:28",days:ALL},{code:"Evening",time:"19:56",days:ALL}] },
      { id:"ma", name:"Massachusetts", emblem:"MA", tz:"ET",
        draws:[{code:"Midday",time:"14:00",days:ALL},{code:"Evening",time:"21:00",days:ALL}] },
      { id:"va", name:"Virginia", emblem:"VA", tz:"ET",
        draws:[{code:"Day",time:"13:59",days:ALL},{code:"Night",time:"23:00",days:ALL}] },
      { id:"mi", name:"Michigan", emblem:"MI", tz:"ET",
        draws:[{code:"Midday",time:"12:59",days:ALL},{code:"Evening",time:"19:29",days:ALL}] },
      { id:"nc", name:"North Carolina", emblem:"NC", tz:"ET",
        draws:[{code:"Day",time:"15:00",days:ALL},{code:"Evening",time:"23:22",days:ALL}] },
      { id:"sc", name:"South Carolina", emblem:"SC", tz:"ET",
        draws:[{code:"Midday",time:"12:59",days:MON_SAT},{code:"Evening",time:"18:59",days:ALL}] },
      { id:"tx", name:"Texas", emblem:"TX", tz:"CT",
        draws:[{code:"Morning",time:"10:00",days:MON_SAT},{code:"Day",time:"12:27",days:MON_SAT},{code:"Evening",time:"18:00",days:MON_SAT},{code:"Night",time:"22:12",days:MON_SAT}] },
      { id:"tn", name:"Tennessee", emblem:"TN", tz:"CT",
        draws:[{code:"Morning",time:"09:28",days:MON_SAT},{code:"Midday",time:"12:28",days:MON_SAT},{code:"Evening",time:"18:28",days:ALL}] }
    ],
    rd: [
      { id:"real", name:"Loter√≠a Real", emblem:"RL", tz:"AST", draws:[{code:"Mediod√≠a",time:"12:55",days:ALL}] },
      { id:"ganamas", name:"Gana M√°s", emblem:"GM", tz:"AST", draws:[{code:"Tarde",time:"14:30",days:ALL}] },
      { id:"loteka", name:"Loteka", emblem:"LK", tz:"AST", draws:[{code:"Noche",time:"19:55",days:ALL}] },
      { id:"nacional", name:"Loter√≠a Nacional", emblem:"LN", tz:"AST", draws:[{code:"Tarde",time:"14:30",days:ALL},{code:"Noche",time:"21:00",days:[1,2,3,4,5,6]},{code:"Domingo",time:"18:00",days:[0]}] },
      { id:"quiniela", name:"Quiniela Pal√© (Leidsa)", emblem:"QP", tz:"AST", draws:[{code:"Diario",time:"20:55",days:[1,2,3,4,5,6]},{code:"Domingo",time:"15:55",days:[0]}] },
      { id:"laprimera", name:"La Primera", emblem:"LP", tz:"AST", draws:[{code:"AM",time:"12:00",days:ALL},{code:"PM",time:"20:00",days:ALL}] },
      { id:"lasuerte", name:"La Suerte Dominicana", emblem:"LS", tz:"AST", draws:[{code:"AM",time:"12:30",days:ALL},{code:"PM",time:"18:00",days:ALL}] },
      { id:"lotedom", name:"LoteDom", emblem:"LD", tz:"AST", draws:[{code:"Tarde",time:"13:55",days:ALL}] }
    ],
    special: [
      { id:"ny-bk", name:"NY-BK", emblem:"BK", tz:"ET", draws:[{code:"AM", time:"12:00", days:ALL},{code:"PM",time:"22:00",days:ALL}] },
      { id:"ny-race", name:"NY Horses", emblem:"NY", tz:"ET", draws:[{code:"R1", time:"14:00", days:ALL},{code:"R2",time:"18:30",days:ALL},{code:"R3",time:"21:30",days:ALL}] },
      { id:"357", name:"3-5-7", emblem:"35", tz:"ET", draws:[{code:"Main", time:"20:30", days:ALL}] }
    ]
  };

  // Store
  const results = JSON.parse(localStorage.getItem("lottoResults")||"{}");
  function setResult(section,id,draw,value){
    results[section] ??= {}; results[section][id] ??= {};
    results[section][id][draw] = { value, ts: new Date().toISOString() };
    localStorage.setItem("lottoResults", JSON.stringify(results)); render();
  }

  // Admin selects
  const catalogSelect = document.getElementById("catalogSelect");
  const drawSelect = document.getElementById("drawSelect");
  function fillCatalogSelect(){
    const groups=[["usa","USA"],["rd","RD"],["special","Special"]];
    catalogSelect.innerHTML="";
    groups.forEach(([key,label])=>{
      catalog[key].forEach(l=>{
        const opt=document.createElement("option");
        opt.value = key+"|"+l.id; opt.textContent = `${label} ‚Äî ${l.name}`; catalogSelect.appendChild(opt);
      });
    });
    fillDraws();
  }
  function fillDraws(){
    const [section,id] = catalogSelect.value.split("|");
    const lot = catalog[section].find(x=>x.id===id);
    drawSelect.innerHTML="";
    lot.draws.forEach(d=>{ const o=document.createElement("option"); o.value=d.code; o.textContent=d.code; drawSelect.appendChild(o); });
  }
  catalogSelect.addEventListener("change",fillDraws);
  document.getElementById("saveManual").addEventListener("click",()=>{
    const [section,id] = catalogSelect.value.split("|");
    setResult(section,id,drawSelect.value,document.getElementById("resultInput").value.trim());
  });
  fillCatalogSelect();

  /*************** OCR (reinstated rich UI) ***************/
  const drop = document.getElementById("drop"); const fileInput=document.getElementById("file");
  drop.addEventListener("click",()=>fileInput.click());
  ;["dragenter","dragover"].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.add("drag")}));
  ;["dragleave","drop"].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.remove("drag")}));
  drop.addEventListener("drop",e=>{ if(e.dataTransfer.files[0]) processImage(e.dataTransfer.files[0]); });
  fileInput.addEventListener("change",e=>{ if(e.target.files[0]) processImage(e.target.files[0]); });

  const ABBR_MAP = [
    // New York
    { keys:["MIDDAY","NY AM","NYMID","NY MID","N Y"], target:{section:"usa",lottery:"ny",draw:"Midday"} },
    { keys:["STATE","NYS","NY PM","NY NIGHT","NEW YORK EVENING","STATE-"], target:{section:"usa",lottery:"ny",draw:"Evening"} },
    // Brooklyn & Horses
    { keys:["BK-DAY","BK DAY","BK AM"], target:{section:"special",lottery:"ny-bk",draw:"AM"} },
    { keys:["BK-TV","BK TV","BK PM","BROOKLYN NIGHT"], target:{section:"special",lottery:"ny-bk",draw:"PM"} },
    { keys:["NY","NY HORSES","HORSES"], target:{section:"special",lottery:"ny-race",draw:"R1"} }, // si hay varias, el usuario edita en tabla
    // New Jersey
    { keys:["NJ-DAY","NJ AM","N J AM","NJ MIDDAY"], target:{section:"usa",lottery:"nj",draw:"Midday"} },
    { keys:["NJ PM","NJ-NIGHT","N J PM"], target:{section:"usa",lottery:"nj",draw:"Evening"} },
    // Connecticut
    { keys:["CT AM","CONN-DAY","CT DAY","C T AM"], target:{section:"usa",lottery:"ct",draw:"Day"} },
    { keys:["CT PM","CONN-NIGHT","C T PM"], target:{section:"usa",lottery:"ct",draw:"Night"} },
    // Florida
    { keys:["FLORIDA AM","FLA AM","FL AM"], target:{section:"usa",lottery:"fl",draw:"Midday"} },
    { keys:["FLORIDA PM","FLA PM","FL PM","FL NIGHT"], target:{section:"usa",lottery:"fl",draw:"Evening"} },
    // Georgia
    { keys:["GEORGIA AM","GA AM"], target:{section:"usa",lottery:"ga",draw:"Midday"} },
    { keys:["GEORGIA EVE","GEORGIA PM","GA PM"], target:{section:"usa",lottery:"ga",draw:"Evening"} },
    { keys:["GEORGIA NIGHT","GA NIGHT"], target:{section:"usa",lottery:"ga",draw:"Night"} },
    // Pennsylvania
    { keys:["PA AM","PENN AM","PA DAY"], target:{section:"usa",lottery:"pa",draw:"Day"} },
    { keys:["PA PM","PENN PM"], target:{section:"usa",lottery:"pa",draw:"Evening"} },
    // RD comunes
    { keys:["LOTEKA"], target:{section:"rd",lottery:"loteka",draw:"Noche"} },
    { keys:["REAL"], target:{section:"rd",lottery:"real",draw:"Mediod√≠a"} },
    { keys:["GANAMAS","GANA MAS"], target:{section:"rd",lottery:"ganamas",draw:"Tarde"} },
    { keys:["QUINIELA PALE","QUINIELA PALE LEIDSA","QUINIELA PALE (LEIDSA)"], target:{section:"rd",lottery:"quiniela",draw:"Diario"} },
    { keys:["NACIONAL"], target:{section:"rd",lottery:"nacional",draw:"Noche"} },
    // Special 357
    { keys:["3.5.7","357","3-5-7"], target:{section:"special",lottery:"357",draw:"Main"} }
  ];

  function norm(s){ return s.toUpperCase().replace(/\s+/g," ").trim(); }

  async function processImage(file){
    const out = document.getElementById("ocrOut");
    out.value = "Leyendo imagen con OCR...";
    try{
      const { data:{ text } } = await Tesseract.recognize(file, 'eng', { logger:m=>{} });
      out.value = text.trim();
      renderOCRTable(text.trim());
    }catch(e){
      out.value = "Error de OCR: " + e.message;
    }
  }

  function parseOCRText(text){
    const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const entries=[];
    for(const raw of lines){
      // label ---- numbers
      const m = raw.match(/^([A-Za-z\.\s\-]{2,24})[\s\-\‚Äî\_:.]+([0-9][0-9\s\-]{1,12})$/);
      if(m){
        entries.push({abbr:m[1].trim(), detected:m[2].trim().replace(/\s+/g,"")});
        continue;
      }
      // or label 123 - 4567
      const m2 = raw.match(/^([A-Za-z\.\s\-]{2,24})\s+([0-9]{2,4}\s*-\s*[0-9]{2,4}|[0-9]{3})$/);
      if(m2){
        entries.push({abbr:m2[1].trim(), detected:m2[2].trim().replace(/\s+/g,"")});
      }
    }
    return entries;
  }

  function findTarget(token){
    const N = norm(token);
    for(const rule of ABBR_MAP){
      for(const k of rule.keys){
        if(N.includes(k)) return rule.target;
      }
    }
    if(N==="MIDDAY") return {section:"usa",lottery:"ny",draw:"Midday"};
    if(N==="STATE") return {section:"usa",lottery:"ny",draw:"Evening"};
    return null;
  }

  function isUSA(section){ return section==="usa"; }
  function validUSA(val){ return /^\d{3}-\d{4}$/.test(val); }
  function validRD(val){ return /^\d{2}-\d{2}-\d{2}$/.test(val) || /^\d{3}$/.test(val); }

  function renderOCRTable(text){
    const rows = Array.isArray(text) ? text : parseOCRText(text);
    const box = document.getElementById("ocrTable"); box.innerHTML="";
    const table = document.createElement("table");
    table.innerHTML = `<thead><tr><th>${i18n[lang].abbr}</th><th>${i18n[lang].map}</th><th>${i18n[lang].detected}</th><th>${i18n[lang].value}</th><th>${i18n[lang].actions}</th></tr></thead>`;
    const tb=document.createElement("tbody");
    rows.forEach(r=>{
      const map = findTarget(r.abbr);
      const tr=document.createElement("tr");
      const mapTxt = map? `${map.section}/${map.lottery}/${map.draw}` : "‚Äî";
      const inp = document.createElement("input"); inp.value = r.detected.replace(/\s*-\s*/g,"-");
      const save = document.createElement("button"); save.className="btn"; save.textContent=i18n[lang].save;
      save.addEventListener("click",()=>{
        if(!map) return;
        const val = inp.value.trim();
        const ok = isUSA(map.section) ? validUSA(val) : validRD(val);
        if(!ok){ inp.style.borderColor="var(--danger)"; setTimeout(()=>inp.style.borderColor="",800); return; }
        setResult(map.section, map.lottery, map.draw, val);
      });
      tr.appendChild(td(r.abbr)); tr.appendChild(td(mapTxt)); tr.appendChild(td(r.detected));
      const tdv=td(""); tdv.appendChild(inp); tr.appendChild(tdv); const tda=td(""); tda.appendChild(save); tr.appendChild(tda);
      tb.appendChild(tr);
    });
    table.appendChild(tb);
    box.appendChild(table);
  }
  function td(t){ const d=document.createElement("td"); d.textContent=t; return d; }
  document.getElementById("btnParse").addEventListener("click",()=>renderOCRTable(document.getElementById("ocrOut").value));

  document.getElementById("btnAssignAll").addEventListener("click",()=>{
    const box=document.getElementById("ocrTable");
    const rows=[...box.querySelectorAll("tbody tr")];
    if(!rows.length) return alert("No hay filas.");
    rows.forEach(tr=>{
      const ab = tr.children[0].textContent;
      const map = findTarget(ab); if(!map) return;
      const val = tr.querySelector("input").value.trim();
      const ok = isUSA(map.section)? validUSA(val) : validRD(val);
      if(ok) setResult(map.section, map.lottery, map.draw, val);
    });
    alert("Filas guardadas.");
  });

  /*************** RENDER tiles ***************/
  function inDays(days,d){ return days.includes(d); }
  function renderSection(key, title){
    const sec=document.createElement("div"); sec.className="section";
    sec.innerHTML=`<h2>${title}</h2><div class="grid"></div>`;
    const grid=sec.querySelector(".grid");
    const q = (document.getElementById("search").value||"").trim().toLowerCase();
    catalog[key].forEach(l=>{
      if(q && !(l.name.toLowerCase().includes(q) || l.id.includes(q))) return;
      l.draws.forEach(d=>{
        const today=new Date().getDay(); if(!inDays(d.days,today)) return;
        const r = results[key]?.[l.id]?.[d.code]?.value || "‚Äî";
        const card=document.createElement("div"); card.className="tile";
        const open = isOpenNow(d);
        card.innerHTML = `
          <div class="badge">
            <div class="emblem">${l.emblem}</div>
            <div class="name">${l.name}</div>
            <div class="pill">${d.code}</div>
          </div>
          <div class="nums">${r}</div>
          <div class="meta">
            <div>${i18n[lang].draw}: ${d.time}</div>
            <div>${i18n[lang].close}: ${minus20(d.time)}</div>
            <div class="status ${open?'':'closed'}">${open? i18n[lang].open : i18n[lang].closed}</div>
            <div style="justify-self:end">${l.tz}</div>
          </div>
        `;
        grid.appendChild(card);
      });
    });
    return sec;
  }
  function isOpenNow(draw){
    const now = new Date();
    const [dh,dm] = draw.time.split(":").map(Number);
    const close = minus20(draw.time).split(":").map(Number);
    const nowMin = now.getHours()*60 + now.getMinutes();
    const dMin = dh*60 + dm; const cMin = (+close[0])*60 + (+close[1]);
    const today=new Date().getDay();
    return nowMin < cMin && draw.days.includes(today);
  }

  function render(){
    const content=document.getElementById("content"); content.innerHTML="";
    content.appendChild(renderSection("usa", i18n[lang].usa));
    content.appendChild(renderSection("rd", i18n[lang].rd));
    content.appendChild(renderSection("special", i18n[lang].special));
  }

  // Search filter from admin
  const search = document.getElementById("search"); if(search) search.addEventListener("input", render);

  // Initial
  applyLang();
  render();

  </script>
</body>
</html>
"""
with open("/mnt/data/beast_reader_v5.html","w",encoding="utf-8") as f:
    f.write(html)

print("Archivo creado: /mnt/data/beast_reader_v5.html")
