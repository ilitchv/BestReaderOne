# Create Beast Reader v6 with:
# - Working theme/lang toggles (wired on admin open)
# - Auto-scroll FAB outside content, very slow; also control inside admin
# - Admin FULL-SCREEN dashboard (after PIN) with tabs:
#   Results (manual), OCR (batch multi-images), Catalog (CRUD with draw times editable & visibility),
#   Logos (upload & assign per lottery), Visibility (toggle which show on landing)
# - Restore catalog persistence; seed with defaults; provide editing per draw (code/time/days), visible flag per lottery
# - Batch OCR: accept multiple images; merge; parse both "line" style and "table" style (first/second/third/pick_3/pick_4)
# - Parser improvements for CONNECT, ANGUILLA, etc. and USA/RD detection
# - Use uploaded logos if provided; fallback to emblem initials
# Save to /mnt/data/beast_reader_v6.html

html = r"""<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Beast Reader ‚Äî Resultados de Loter√≠as</title>
<style>
  :root{
    --bg:#0a0b10; --card:#10142a; --text:#e7f0ff; --muted:#a8b3d8;
    --accent1:#5df6ff; --accent2:#8a5dff; --accent3:#18ffb2;
    --danger:#ff4d6d; --ok:#1be7a8; --tile:160px;
    --ring:0 0 10px rgba(93,246,255,.22), 0 0 28px rgba(138,93,255,.18);
  }
  [data-theme="light"]{
    --bg:#f7f8ff; --card:#ffffff; --text:#0b1020; --muted:#4a5578;
    --accent1:#00a3ff; --accent2:#6a40ff; --accent3:#00c07a;
    --danger:#d7003a; --ok:#07a87e;
  }
  body{margin:0;background:radial-gradient(1200px 1200px at 10% -10%, rgba(93,246,255,.10), transparent 60%),
                              radial-gradient(900px 900px at 110% 10%, rgba(138,93,255,.12), transparent 60%),
                              var(--bg);
       color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;z-index:50;backdrop-filter:blur(10px);
         background:linear-gradient(180deg, rgba(10,11,16,.85), rgba(10,11,16,.55));border-bottom:1px solid rgba(141,160,255,.15)}
  [data-theme="light"] header{background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55))}
  .wrap{max-width:1200px;margin:0 auto;padding:14px 18px;display:flex;gap:14px;align-items:center}
  .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
  .logo svg{width:40px;height:40px;filter:drop-shadow(0 0 12px rgba(93,246,255,.5))}
  .logo h1{font-size:clamp(18px,3.2vw,28px);margin:0}
  .sub{font-size:12px;color:var(--muted)}
  main{max-width:1200px;margin:18px auto 64px;padding:0 14px}
  .section{margin-bottom:18px}
  .section h2{margin:0 0 12px 0;font-size:18px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--tile),1fr));gap:12px}
  .tile{position:relative;background:linear-gradient(135deg, rgba(93,246,255,.08), rgba(138,93,255,.08));
        border:1px solid rgba(141,160,255,.25);border-radius:14px;padding:10px;
        aspect-ratio:1/1.05;display:flex;flex-direction:column;justify-content:space-between;
        box-shadow:var(--ring);overflow:hidden}
  .badge{display:flex;align-items:center;gap:6px;font-weight:800}
  .emblem{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent1),var(--accent3));
          display:grid;place-items:center;color:#001018;font-size:14px;font-weight:900;box-shadow:0 0 16px rgba(93,246,255,.5);overflow:hidden}
  .emblem img{width:100%;height:100%;object-fit:cover;border-radius:8px}
  .name{font-size:13px;color:var(--muted)}
  .pill{font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(255,255,255,.06);
        border:1px solid rgba(255,255,255,.1);color:#cbd5e1;margin-left:auto}
  .nums{font-size:22px;letter-spacing:2px;font-weight:900}
  .meta{display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:10px;color:var(--muted);align-items:center}
  .status{font-size:10px;padding:2px 6px;border-radius:999px;justify-self:start;background:rgba(24,255,178,.15);color:#00df9a;border:1px solid rgba(24,255,178,.35)}
  .status.closed{background:rgba(255,77,109,.12);color:#ff6682;border-color:rgba(255,77,109,.35)}
  /* Admin open tab */
  .admin-tab{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:60;
    background:linear-gradient(180deg,var(--accent2),var(--accent1));color:#031018;
    padding:8px 10px;border-top-right-radius:12px;border-bottom-right-radius:12px;
    font-weight:800;cursor:pointer;box-shadow:var(--ring);user-select:none}
  /* Auto scroll FAB */
  .fab{position:fixed;right:14px;bottom:18px;z-index:55;background:linear-gradient(135deg,var(--accent1),var(--accent2));
       color:#031018;border:0;padding:10px 12px;border-radius:999px;box-shadow:var(--ring);font-weight:800;cursor:pointer;opacity:.85}
  .fab:hover{opacity:1}
  /* Fullscreen Admin Dashboard */
  .dash{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:80}
  .dash.open{display:block}
  .desk{position:absolute;inset:24px;display:flex;flex-direction:column;background:var(--card);
        border:1px solid rgba(141,160,255,.25);border-radius:14px;box-shadow:var(--ring);overflow:hidden}
  .desk .bar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(141,160,255,.25)}
  .tabs{display:flex;gap:6px}
  .tab{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px;cursor:pointer}
  .tab.active{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#031018;font-weight:800}
  .desk .body{flex:1;display:none;padding:12px;overflow:auto}
  .desk .body.active{display:block}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
  input[type="text"],input[type="password"],select,textarea{background:#0e1424;color:var(--text);border:1px solid rgba(141,160,255,.25);border-radius:10px;padding:8px 10px}
  [data-theme="light"] input[type="text"],[data-theme="light"] input[type="password"],[data-theme="light"] select,[data-theme="light"] textarea{background:#fff;color:#111}
  .btn{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#06121b;border:0;padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:var(--ring)}
  .ghost{background:transparent;border:1px solid rgba(141,160,255,.3);color:var(--text);padding:7px 10px;border-radius:10px;cursor:pointer}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{border-bottom:1px solid rgba(141,160,255,.2);padding:6px;vertical-align:top}
  .ocr-drop{border:1px dashed rgba(141,160,255,.35);padding:12px;border-radius:10px;text-align:center}
  .ocr-drop.drag{background:rgba(93,246,255,.08)}
  .tag{display:inline-flex;gap:6px;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid rgba(141,160,255,.25);font-size:11px}
  .eye{cursor:pointer;user-select:none;font-size:18px;padding:6px}
  /* PIN modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55);z-index:90}
  .modal.open{display:grid}
  .card{width:min(420px,92vw);background:var(--card);border-radius:12px;border:1px solid rgba(141,160,255,.25);box-shadow:var(--ring);padding:12px}
</style>
</head>
<body data-theme="dark">
  <div class="admin-tab" id="adminTab">ADMIN</div>
  <button class="fab" id="autoScrollFab">‚ü± Auto</button>

  <!-- PIN -->
  <div class="modal" id="pinModal">
    <div class="card">
      <h3 id="pinTitle">Acceso administrador</h3>
      <div class="field">
        <label id="pinLabel">Introduce PIN</label>
        <div class="row">
          <input id="pinInput" type="password" inputmode="numeric" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
          <span id="toggleEye" class="eye" title="Mostrar/Ocultar">üëÅÔ∏è</span>
          <button class="btn" id="pinOk">Entrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Dashboard fullscreen -->
  <div class="dash" id="adminDash" aria-hidden="true">
    <div class="desk">
      <div class="bar">
        <strong>Beast Reader ‚Äî Admin</strong>
        <span class="tag">Idioma <input id="langTgl" type="checkbox"/><span class="tag">ES/EN</span></span>
        <span class="tag">Tema <input id="themeTgl" type="checkbox"/><span class="tag">Dark/Light</span></span>
        <input id="search" placeholder="Buscar..." style="margin-left:auto;min-width:220px"/>
        <button class="ghost" id="closeAdmin">Cerrar</button>
      </div>
      <div class="bar">
        <div class="tabs">
          <div class="tab active" data-tab="results">Resultados</div>
          <div class="tab" data-tab="ocr">OCR</div>
          <div class="tab" data-tab="catalog">Cat√°logo</div>
          <div class="tab" data-tab="logos">Logos</div>
          <div class="tab" data-tab="visibility">Visibilidad</div>
        </div>
      </div>
      <div class="body active" id="tab-results">
        <div class="field"><em>Editar/guardar resultados manualmente.</em></div>
        <div id="manualTable"></div>
      </div>
      <div class="body" id="tab-ocr">
        <div class="row">
          <div class="field" style="flex:1">
            <label>OCR ‚Äî Arrastra im√°genes o haz clic (m√∫ltiples)</label>
            <div id="drop" class="ocr-drop">Suelta aqu√≠ (.jpg/.png). <input type="file" id="file" accept="image/*" multiple hidden /></div>
          </div>
          <div class="field">
            <label>Acciones</label>
            <div class="row">
              <button class="ghost" id="btnParse">Previsualizar tabla</button>
              <button class="btn" id="btnAssignAll">Guardar todos</button>
            </div>
          </div>
        </div>
        <div class="field">
          <label>Contenido OCR (bruto)</label>
          <textarea id="ocrOut" rows="8" placeholder="Aqu√≠ aparecer√° el texto detectado..."></textarea>
        </div>
        <div class="field">
          <label>Tabla detectada</label>
          <div id="ocrTable"></div>
        </div>
      </div>
      <div class="body" id="tab-catalog">
        <div class="row" style="justify-content:space-between">
          <div><strong>Cat√°logo (editar draws, horas y visibilidad)</strong></div>
          <div class="row">
            <button class="ghost" id="addLottery">A√±adir loter√≠a</button>
            <button class="ghost" id="addDraw">A√±adir draw a selecci√≥n</button>
            <button class="btn" id="saveCatalog">Guardar cat√°logo</button>
          </div>
        </div>
        <div id="catalogTable"></div>
      </div>
      <div class="body" id="tab-logos">
        <div class="row">
          <input id="logoFile" type="file" accept="image/*" multiple/>
          <button class="ghost" id="assignLogo">Asignar a selecci√≥n</button>
          <button class="ghost" id="removeLogo">Quitar logo de selecci√≥n</button>
        </div>
        <div id="logoGrid"></div>
      </div>
      <div class="body" id="tab-visibility">
        <div class="field"><em>Marca qu√© loter√≠as se muestran en la p√°gina p√∫blica.</em></div>
        <div id="visibilityTable"></div>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap">
      <a class="logo" href="#">
        <svg viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#5df6ff"/><stop offset="1" stop-color="#8a5dff"/></linearGradient></defs>
          <rect x="4" y="4" width="64" height="64" rx="14" fill="url(#g1)"/>
          <circle cx="26" cy="28" r="5" fill="#001219"/><circle cx="46" cy="28" r="5" fill="#001219"/>
          <path d="M18 46c10-2 22-12 18-22-3 8 8 14 19 11-4 12-18 19-37 11z" fill="#001219" opacity=".85"/>
        </svg>
        <div>
          <h1>Beast Reader</h1>
          <div class="sub" id="subTitle">Resultados en vivo ‚Äî USA, RD & Special</div>
        </div>
      </a>
    </div>
  </header>

  <main id="content"></main>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script>
  /*************** i18n ***************/
  const i18n={ es:{usa:"Loter√≠as de USA",rd:"Loter√≠as de Santo Domingo",special:"Loter√≠as Special",open:"Abierta",closed:"Cerrada",draw:"Sorteo",close:"Cierre",save:"Guardar",saveAll:"Guardar todos",abbr:"Abrev.",map:"Mapa",detected:"Detectado",value:"Valor",actions:"Acciones"}, 
              en:{usa:"USA Lotteries",rd:"Santo Domingo Lotteries",special:"Special Lotteries",open:"Open",closed:"Closed",draw:"Draw",close:"Close",save:"Save",saveAll:"Save all",abbr:"Abbrev.",map:"Map",detected:"Detected",value:"Value",actions:"Actions"} };
  let lang=localStorage.getItem("lang")||"es";
  function applyLang(){ document.getElementById("subTitle").textContent = lang==="es"?"Resultados en vivo ‚Äî USA, RD & Special":"Live results ‚Äî USA, RD & Special"; render(); }

  /*************** Theme ***************/
  const savedTheme=localStorage.getItem("theme")||"dark"; document.body.setAttribute("data-theme",savedTheme);

  /*************** Admin open + PIN ***************/
  const ADMIN_PIN="1983";
  const adminTab=document.getElementById("adminTab");
  const adminDash=document.getElementById("adminDash");
  const pinModal=document.getElementById("pinModal");
  const pinInput=document.getElementById("pinInput");
  const pinOk=document.getElementById("pinOk");
  const toggleEye=document.getElementById("toggleEye");
  adminTab.addEventListener("click",()=>{pinModal.classList.add("open"); pinInput.value=""; pinInput.type="password";});
  pinOk.addEventListener("click",()=>{ if(pinInput.value===ADMIN_PIN){ pinModal.classList.remove("open"); openAdmin(); } else { pinInput.style.borderColor="var(--danger)"; setTimeout(()=>pinInput.style.borderColor="",600);} });
  toggleEye.addEventListener("click",()=>{ pinInput.type=pinInput.type==="password"?"text":"password"; });
  pinModal.addEventListener("click",e=>{ if(e.target===pinModal) pinModal.classList.remove("open"); });

  function openAdmin(){
    adminDash.classList.add("open");
    // Tabs
    const tabs=[...document.querySelectorAll(".tab")];
    const bodies=[...document.querySelectorAll(".desk .body")];
    function setTab(id){ tabs.forEach(t=>t.classList.toggle("active", t.dataset.tab===id)); bodies.forEach(b=>b.classList.toggle("active", b.id==="tab-"+id)); if(id==="results") buildManual(); if(id==="ocr") buildOCR(); if(id==="catalog") buildCatalog(); if(id==="logos") buildLogos(); if(id==="visibility") buildVisibility(); }
    tabs.forEach(t=>t.onclick=()=>setTab(t.dataset.tab)); setTab("results");
    document.getElementById("closeAdmin").onclick=()=>adminDash.classList.remove("open");
    // Wire toggles every open
    const themeTgl=document.getElementById("themeTgl"); const langTgl=document.getElementById("langTgl");
    themeTgl.checked=(localStorage.getItem("theme")||"dark")==="light";
    langTgl.checked=(lang==="en");
    themeTgl.onchange=(e)=>{const th=e.target.checked?"light":"dark"; document.body.setAttribute("data-theme",th); localStorage.setItem("theme",th);};
    langTgl.onchange=(e)=>{ lang=e.target.checked?"en":"es"; localStorage.setItem("lang",lang); applyLang(); };
    document.getElementById("search").oninput=()=>render();
  }

  /*************** Auto scroll (very slow) ***************/
  let scrollTimer=null, scrollDown=true;
  const autoFab=document.getElementById("autoScrollFab");
  autoFab.addEventListener("click",()=>{
    if(scrollTimer){ clearInterval(scrollTimer); scrollTimer=null; autoFab.textContent="‚ü± Auto"; return;}
    autoFab.textContent="‚ñ† Stop"; const area=document.scrollingElement;
    scrollTimer=setInterval(()=>{
      const step=0.05; // ultra slow
      area.scrollBy(0, scrollDown?step:-step);
      if(area.scrollTop+window.innerHeight+2>=area.scrollHeight) scrollDown=false;
      if(area.scrollTop<=1) scrollDown=true;
    }, 30);
  });

  /*************** Catalog with persistence ***************/
  const KEY_CATALOG="br_catalog_v1"; const KEY_RESULTS="br_results_v1"; const KEY_LOGOS="br_logos_v1";
  function minus20(t){const [H,M]=t.split(":").map(Number); const d=new Date(); d.setHours(H,M,0,0); d.setMinutes(d.getMinutes()-20); return d.toTimeString().slice(0,5);}
  const ALL=[0,1,2,3,4,5,6], MON_SAT=[1,2,3,4,5,6];
  const SEED={
    usa:[
      {id:"ny", name:"New York", tz:"ET", visible:true, draws:[{code:"Midday", time:"14:30", days:ALL},{code:"Evening", time:"22:30", days:ALL}]},
      {id:"nj", name:"New Jersey", tz:"ET", visible:true, draws:[{code:"Midday", time:"12:59", days:ALL},{code:"Evening", time:"22:57", days:ALL}]},
      {id:"ct", name:"Connecticut", tz:"ET", visible:true, draws:[{code:"Day", time:"13:57", days:ALL},{code:"Night", time:"22:29", days:ALL}]},
      {id:"fl", name:"Florida", tz:"ET", visible:true, draws:[{code:"Midday", time:"13:30", days:ALL},{code:"Evening", time:"21:45", days:ALL}]},
      {id:"ga", name:"Georgia", tz:"ET", visible:true, draws:[{code:"Midday", time:"12:29", days:ALL},{code:"Evening", time:"18:59", days:ALL},{code:"Night", time:"23:34", days:ALL}]},
      {id:"pa", name:"Pennsylvania", tz:"ET", visible:true, draws:[{code:"Day", time:"13:35", days:ALL},{code:"Evening", time:"18:59", days:ALL}]},
      {id:"de", name:"Delaware", tz:"ET", visible:true, draws:[{code:"Day", time:"13:58", days:ALL},{code:"Night", time:"19:57", days:ALL}]},
      {id:"md", name:"Maryland", tz:"ET", visible:true, draws:[{code:"Midday", time:"12:28", days:ALL},{code:"Evening", time:"19:56", days:ALL}]},
      {id:"ma", name:"Massachusetts", tz:"ET", visible:true, draws:[{code:"Midday", time:"14:00", days:ALL},{code:"Evening", time:"21:00", days:ALL}]},
      {id:"va", name:"Virginia", tz:"ET", visible:true, draws:[{code:"Day", time:"13:59", days:ALL},{code:"Night", time:"23:00", days:ALL}]},
      {id:"mi", name:"Michigan", tz:"ET", visible:true, draws:[{code:"Midday", time:"12:59", days:ALL},{code:"Evening", time:"19:29", days:ALL}]},
      {id:"nc", name:"North Carolina", tz:"ET", visible:true, draws:[{code:"Day", time:"15:00", days:ALL},{code:"Evening", time:"23:22", days:ALL}]},
      {id:"sc", name:"South Carolina", tz:"ET", visible:true, draws:[{code:"Midday", time:"12:59", days:MON_SAT},{code:"Evening", time:"18:59", days:ALL}]},
      {id:"tx", name:"Texas", tz:"CT", visible:true, draws:[{code:"Morning", time:"10:00", days:MON_SAT},{code:"Day", time:"12:27", days:MON_SAT},{code:"Evening", time:"18:00", days:MON_SAT},{code:"Night", time:"22:12", days:MON_SAT}]},
      {id:"tn", name:"Tennessee", tz:"CT", visible:true, draws:[{code:"Morning", time:"09:28", days:MON_SAT},{code:"Midday", time:"12:28", days:MON_SAT},{code:"Evening", time:"18:28", days:ALL}]}
    ],
    rd:[
      {id:"real", name:"Loter√≠a Real", tz:"AST", visible:true, draws:[{code:"Mediod√≠a", time:"12:55", days:ALL}]},
      {id:"ganamas", name:"Gana M√°s", tz:"AST", visible:true, draws:[{code:"Tarde", time:"14:30", days:ALL}]},
      {id:"loteka", name:"Loteka", tz:"AST", visible:true, draws:[{code:"Noche", time:"19:55", days:ALL}]},
      {id:"nacional", name:"Loter√≠a Nacional", tz:"AST", visible:true, draws:[{code:"Tarde", time:"14:30", days:ALL},{code:"Noche", time:"21:00", days:[1,2,3,4,5,6]},{code:"Domingo", time:"18:00", days:[0]}]},
      {id:"quiniela", name:"Quiniela Pal√© (Leidsa)", tz:"AST", visible:true, draws:[{code:"Diario", time:"20:55", days:[1,2,3,4,5,6]},{code:"Domingo", time:"15:55", days:[0]}]},
      {id:"laprimera", name:"La Primera", tz:"AST", visible:true, draws:[{code:"AM", time:"12:00", days:ALL},{code:"PM", time:"20:00", days:ALL}]},
      {id:"lasuerte", name:"La Suerte Dominicana", tz:"AST", visible:true, draws:[{code:"AM", time:"12:30", days:ALL},{code:"PM", time:"18:00", days:ALL}]},
      {id:"lotedom", name:"LoteDom", tz:"AST", visible:true, draws:[{code:"Tarde", time:"13:55", days:ALL}]}
    ],
    special:[
      {id:"ny-bk", name:"NY-BK", tz:"ET", visible:true, draws:[{code:"AM", time:"12:00", days:ALL},{code:"PM", time:"22:00", days:ALL}]},
      {id:"ny-race", name:"NY Horses", tz:"ET", visible:true, draws:[{code:"R1", time:"14:00", days:ALL},{code:"R2", time:"18:30", days:ALL},{code:"R3", time:"21:30", days:ALL}]},
      {id:"357", name:"3-5-7", tz:"ET", visible:true, draws:[{code:"Main", time:"20:30", days:ALL}]}
    ]
  };
  function loadCatalog(){ return JSON.parse(localStorage.getItem(KEY_CATALOG)||"null")||SEED; }
  function saveCatalog(cat){ localStorage.setItem(KEY_CATALOG, JSON.stringify(cat)); }
  const logos = JSON.parse(localStorage.getItem(KEY_LOGOS)||"{}");
  function saveLogos(){ localStorage.setItem(KEY_LOGOS, JSON.stringify(logos)); }

  const results = JSON.parse(localStorage.getItem(KEY_RESULTS)||"{}");
  function setResult(section,id,draw,value){
    results[section]??={}; results[section][id]??={}; results[section][id][draw]={value,ts:new Date().toISOString()};
    localStorage.setItem(KEY_RESULTS, JSON.stringify(results)); render();
  }

  /*************** Build Manual Results table ***************/
  function buildManual(){
    const host=document.getElementById("manualTable"); host.innerHTML="";
    const cat=loadCatalog();
    Object.keys(cat).forEach(section=>{
      const h=document.createElement("h3"); h.textContent=(section==="usa"?i18n[lang].usa:section==="rd"?i18n[lang].rd:i18n[lang].special); host.appendChild(h);
      const table=document.createElement("table");
      table.innerHTML="<thead><tr><th>Loter√≠a</th><th>Draw</th><th>Hora sorteo</th><th>Hora cierre</th><th>Resultado</th><th></th></tr></thead>";
      const tb=document.createElement("tbody");
      cat[section].forEach(l=>{
        if(!l.visible) return;
        l.draws.forEach(d=>{
          const tr=document.createElement("tr");
          const key=`${section}/${l.id}/${d.code}`; const res=results[section]?.[l.id]?.[d.code]?.value||"";
          const inp=document.createElement("input"); const fmt=section==="usa"?"123-4567":"12-34-56"; inp.placeholder=fmt; inp.value=res;
          const btn=document.createElement("button"); btn.className="btn"; btn.textContent=i18n[lang].save; btn.onclick=()=>setResult(section,l.id,d.code,inp.value.trim());
          tr.appendChild(td(l.name)); tr.appendChild(td(d.code)); tr.appendChild(td(d.time)); tr.appendChild(td(minus20(d.time)));
          const tdv=td(""); tdv.appendChild(inp); tr.appendChild(tdv); const tdb=td(""); tdb.appendChild(btn); tr.appendChild(tdb);
          tb.appendChild(tr);
        });
      });
      table.appendChild(tb); host.appendChild(table);
    });
  }

  /*************** OCR (batch) ***************/
  let OCR_TEXTS=[];
  function buildOCR(){
    // wire handlers
    const drop=document.getElementById("drop"); const fileInput=document.getElementById("file"); const out=document.getElementById("ocrOut");
    drop.onclick=()=>fileInput.click();
    ["dragenter","dragover"].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.add("drag")}));
    ["dragleave","drop"].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.remove("drag")}));
    drop.addEventListener("drop",e=>{ if(e.dataTransfer.files?.length) processFiles([...e.dataTransfer.files]); });
    fileInput.onchange=(e)=>{ if(e.target.files?.length) processFiles([...e.target.files]); };
    document.getElementById("btnParse").onclick=()=>renderOCRTable(out.value);
    document.getElementById("btnAssignAll").onclick=()=>assignAllFromOCR();
  }
  async function processFiles(files){
    const out=document.getElementById("ocrOut"); out.value="Procesando "+files.length+" imagen(es)...";
    OCR_TEXTS=[];
    for(const f of files){
      try{ const {data:{text}}=await Tesseract.recognize(f,'eng',{logger:m=>{}}); OCR_TEXTS.push(text.trim()); }catch(e){ OCR_TEXTS.push("ERROR "+e.message); }
    }
    out.value=OCR_TEXTS.join("\n---\n");
    renderOCRTable(out.value);
  }
  function parseOCRTextBlock(txt){
    // Try to parse "table mode" if headers present
    const out=[]; const lines=txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const header = lines.find(x=>/loter[i√≠]a|first|second|third|pick_3|pick_4/i.test(x));
    if(header){
      // Expect rows: NAME ... cols; we'll grab name then numbers
      for(const ln of lines){
        const m = ln.match(/^([A-Za-z0-9\-\s\.]+?)\s+((?:\d{2}|x{1,2}|xx)\b.*)$/i);
        if(!m) continue;
        const name=m[1].trim(); const right=m[2].trim().replace(/\s+/g,' ').replace(/\s-\s/g,'-');
        // pick3/pick4 detection
        const p3=right.match(/\b(\d{3})\b(?!-)/); const p4=right.match(/\b(\d{4})\b/);
        const pairs=(right.match(/\b\d{2}\b/g)||[]).slice(0,3);
        out.push({abbr:name, detected: p3&&p4 ? (p3[1]+"-"+p4[1]) : pairs.length===3 ? pairs.join("-") : right});
      }
      return out;
    }
    // Fallback: line mode "label --- nums" or "label nums"
    const rows=[];
    for(const raw of lines){
      const m = raw.match(/^([A-Za-z\.\s\-]{2,28})[\s\-\‚Äî\_:.]+([0-9xX][0-9xX\s\-]{1,12})$/);
      if(m){ rows.push({abbr:m[1].trim(), detected:m[2].trim().replace(/\s+/g,"")}); continue; }
      const m2 = raw.match(/^([A-Za-z\.\s\-]{2,28})\s+([0-9]{2,4}\s*-\s*[0-9]{2,4}|[0-9]{3})$/);
      if(m2){ rows.push({abbr:m2[1].trim(), detected:m2[2].trim().replace(/\s+/g,"")}); }
    }
    return rows;
  }
  function renderOCRTable(text){
    const box=document.getElementById("ocrTable"); box.innerHTML="";
    const rows = text.split(/\n---\n/).flatMap(parseOCRTextBlock);
    const table=document.createElement("table");
    table.innerHTML=`<thead><tr><th>${i18n[lang].abbr}</th><th>${i18n[lang].map}</th><th>${i18n[lang].detected}</th><th>${i18n[lang].value}</th><th>${i18n[lang].actions}</th></tr></thead>`;
    const tb=document.createElement("tbody");
    rows.forEach(r=>{
      const map=findTarget(r.abbr);
      const tr=document.createElement("tr");
      const mapTxt=map?`${map.section}/${map.id}/${map.draw}`:"‚Äî";
      const inp=document.createElement("input"); inp.value=r.detected.replace(/\s*-\s*/g,"-");
      const btn=document.createElement("button"); btn.className="btn"; btn.textContent=i18n[lang].save;
      btn.onclick=()=>{ if(!map) return; const val=inp.value.trim(); const ok = map.section==="usa" ? /^\d{3}-\d{4}$/.test(val) : (/^\d{2}-\d{2}-\d{2}$/.test(val)||/^\d{3}$/.test(val)); if(!ok){inp.style.borderColor="var(--danger)"; setTimeout(()=>inp.style.borderColor="",800); return;} setResult(map.section,map.id,map.draw,val); };
      tr.appendChild(td(r.abbr)); tr.appendChild(td(mapTxt)); tr.appendChild(td(r.detected)); const tdv=td(""); tdv.appendChild(inp); tr.appendChild(tdv); const tdb=td(""); tdb.appendChild(btn); tr.appendChild(tdb);
      tb.appendChild(tr);
    });
    table.appendChild(tb); box.appendChild(table);
  }
  function assignAllFromOCR(){
    const rows=[...document.querySelectorAll("#ocrTable tbody tr")];
    rows.forEach(tr=>{ const ab=tr.children[0].textContent; const map=findTarget(ab); if(!map) return; const val=tr.querySelector("input").value.trim(); const ok = map.section==="usa" ? /^\d{3}-\d{4}$/.test(val) : (/^\d{2}-\d{2}-\d{2}$/.test(val)||/^\d{3}$/.test(val)); if(ok) setResult(map.section,map.id,map.draw,val); });
    alert("Filas guardadas.");
  }

  /*************** Catalog CRUD ***************/
  function buildCatalog(){
    const host=document.getElementById("catalogTable"); host.innerHTML="";
    const cat=loadCatalog();
    const table=document.createElement("table"); table.innerHTML="<thead><tr><th>Secci√≥n</th><th>Loter√≠a</th><th>Visible</th><th>Draw</th><th>Hora sorteo</th><th>D√≠as (0-6)</th><th></th></tr></thead>";
    const tb=document.createElement("tbody");
    Object.keys(cat).forEach(section=>{
      cat[section].forEach((l,li)=>{
        l.draws.forEach((d,di)=>{
          const tr=document.createElement("tr");
          const vis=document.createElement("input"); vis.type="checkbox"; vis.checked=!!l.visible; vis.onchange=()=>{ l.visible=vis.checked; };
          const time=document.createElement("input"); time.value=d.time; time.oninput=()=>d.time=time.value;
          const code=document.createElement("input"); code.value=d.code; code.oninput=()=>d.code=code.value;
          const days=document.createElement("input"); days.value=d.days.join(","); days.oninput=()=>{ d.days = days.value.split(",").map(x=>+x.trim()).filter(x=>!Number.isNaN(x)); };
          const del=document.createElement("button"); del.className="ghost"; del.textContent="Eliminar draw"; del.onclick=()=>{ l.draws.splice(di,1); buildCatalog(); };
          tr.appendChild(td(section)); tr.appendChild(td(l.name)); const tv=td(""); tv.appendChild(vis); tr.appendChild(tv);
          const tcode=td(""); tcode.appendChild(code); tr.appendChild(tcode);
          const ttime=td(""); ttime.appendChild(time); tr.appendChild(ttime);
          const tdays=td(""); tdays.appendChild(days); tr.appendChild(tdays);
          const tdel=td(""); tdel.appendChild(del); tr.appendChild(tdel);
          tb.appendChild(tr);
        });
      });
    });
    table.appendChild(tb); host.appendChild(table);
    document.getElementById("addLottery").onclick=()=>{
      const sec=prompt("Secci√≥n (usa/rd/special)","usa"); if(!sec||!cat[sec]) return;
      const id=prompt("ID interno (ej: ny2)").trim(); const name=prompt("Nombre p√∫blico").trim(); if(!id||!name) return;
      cat[sec].push({id,name,tz:"ET",visible:true,draws:[{code:"Midday",time:"12:00",days:[1,2,3,4,5,6,0]}]}); saveCatalog(cat); buildCatalog();
    };
    document.getElementById("addDraw").onclick=()=>{
      const sec=prompt("Secci√≥n del ID de loter√≠a (usa/rd/special)"); const id=prompt("ID de loter√≠a a editar");
      const lot=(cat[sec]||[]).find(x=>x.id===id); if(!lot) return alert("No encontrada.");
      lot.draws.push({code:"New",time:"12:00",days:[1,2,3,4,5,6,0]}); saveCatalog(cat); buildCatalog();
    };
    document.getElementById("saveCatalog").onclick=()=>{ saveCatalog(cat); alert("Cat√°logo guardado."); render(); buildVisibility(); buildManual(); };
  }

  /*************** Logos ***************/
  function buildLogos(){
    const grid=document.getElementById("logoGrid"); grid.innerHTML="";
    const cat=loadCatalog();
    const files=document.getElementById("logoFile");
    function row(section,l){
      const div=document.createElement("div"); div.className="row"; div.style.margin="6px 0";
      const img=document.createElement("img"); img.style.width="36px"; img.style.height="36px"; img.style.borderRadius="8px"; img.style.objectFit="cover";
      const key=`${section}/${l.id}`; if(logos[key]) img.src=logos[key];
      const btn=document.createElement("button"); btn.className="ghost"; btn.textContent="Seleccionar"; btn.onclick=()=>{ selected={section,id:l.id}; highlight(); };
      const name=document.createElement("div"); name.textContent=`${section} ‚Äî ${l.name}`; name.style.minWidth="240px";
      div.appendChild(img); div.appendChild(name); div.appendChild(btn); return div;
    }
    let selected=null; function highlight(){ [...grid.querySelectorAll(".row")].forEach(r=>r.style.outline=""); if(selected){ const key=`${selected.section}/${selected.id}`; const el=[...grid.querySelectorAll(".row")].find(r=>r.textContent.includes(` ${selected.section} ‚Äî `) && r.textContent.includes(selected.id) ); if(el) el.style.outline="2px solid rgba(93,246,255,.6)"; } }
    Object.keys(cat).forEach(sec=>{ cat[sec].forEach(l=>grid.appendChild(row(sec,l))); });
    document.getElementById("assignLogo").onclick=()=>{
      if(!selected) return alert("Selecciona una loter√≠a de la lista.");
      if(!files.files?.length) return alert("Sube una imagen.");
      const f=files.files[0]; const reader=new FileReader(); reader.onload=()=>{ logos[`${selected.section}/${selected.id}`]=reader.result; saveLogos(); buildLogos(); render(); }; reader.readAsDataURL(f);
    };
    document.getElementById("removeLogo").onclick=()=>{ if(!selected) return; delete logos[`${selected.section}/${selected.id}`]; saveLogos(); buildLogos(); render(); };
  }

  /*************** Visibility tab ***************/
  function buildVisibility(){
    const host=document.getElementById("visibilityTable"); host.innerHTML="";
    const cat=loadCatalog();
    const table=document.createElement("table"); table.innerHTML="<thead><tr><th>Secci√≥n</th><th>Loter√≠a</th><th>Visible</th></tr></thead>";
    const tb=document.createElement("tbody");
    Object.keys(cat).forEach(section=>{
      cat[section].forEach(l=>{
        const tr=document.createElement("tr"); const vis=document.createElement("input"); vis.type="checkbox"; vis.checked=!!l.visible; vis.onchange=()=>{ l.visible=vis.checked; saveCatalog(cat); render(); };
        tr.appendChild(td(section)); tr.appendChild(td(l.name)); const tv=td(""); tv.appendChild(vis); tr.appendChild(tv); tb.appendChild(tr);
      });
    });
    table.appendChild(tb); host.appendChild(table);
  }

  /*************** Mapping for OCR ***************/
  const MAP=[
    // NY
    {k:["MIDDAY","NY AM","NY MID","N Y"], map:{section:"usa",id:"ny",draw:"Midday"}},
    {k:["STATE","NYS","NY PM","NY NIGHT","NEW YORK EVENING","STATE-"], map:{section:"usa",id:"ny",draw:"Evening"}},
    // BK / Horses
    {k:["BK-DAY","BK DAY","BK AM"], map:{section:"special",id:"ny-bk",draw:"AM"}},
    {k:["BK-TV","BK TV","BK PM"], map:{section:"special",id:"ny-bk",draw:"PM"}},
    {k:["NY","NY HORSES","HORSES"], map:{section:"special",id:"ny-race",draw:"R1"}},
    // NJ
    {k:["NJ-DAY","NJ AM","N J AM","NJ MIDDAY","NJ A M"], map:{section:"usa",id:"nj",draw:"Midday"}},
    {k:["NJ PM","NJ-NIGHT","N J PM"], map:{section:"usa",id:"nj",draw:"Evening"}},
    // CT
    {k:["CT AM","CONNECT AM","CONN-DAY","CT DAY","C T AM"], map:{section:"usa",id:"ct",draw:"Day"}},
    {k:["CT PM","CONNECT PM","CONN-NIGHT","C T PM"], map:{section:"usa",id:"ct",draw:"Night"}},
    // FL
    {k:["FLORIDA AM","FL AM","FLA AM"], map:{section:"usa",id:"fl",draw:"Midday"}},
    {k:["FLORIDA PM","FL PM","FLA PM","FL NIGHT"], map:{section:"usa",id:"fl",draw:"Evening"}},
    // GA
    {k:["GEORGIA AM","GA AM"], map:{section:"usa",id:"ga",draw:"Midday"}},
    {k:["GEORGIA EVE","GEORGIA PM","GA PM"], map:{section:"usa",id:"ga",draw:"Evening"}},
    {k:["GEORGIA NIGHT","GA NIGHT"], map:{section:"usa",id:"ga",draw:"Night"}},
    // PA
    {k:["PA AM","PENN AM","PA DAY"], map:{section:"usa",id:"pa",draw:"Day"}},
    {k:["PA PM","PENN PM"], map:{section:"usa",id:"pa",draw:"Evening"}},
    // RD
    {k:["LOTEKA"], map:{section:"rd",id:"loteka",draw:"Noche"}},
    {k:["REAL"], map:{section:"rd",id:"real",draw:"Mediod√≠a"}},
    {k:["GANA MAS","GANAMAS"], map:{section:"rd",id:"ganamas",draw:"Tarde"}},
    {k:["QUINIELA PALE","QUINIELA PALE LEIDSA"], map:{section:"rd",id:"quiniela",draw:"Diario"}},
    {k:["NACIONAL"], map:{section:"rd",id:"nacional",draw:"Noche"}},
    // Special
    {k:["ANGUILLA 10AM","ANGUILLA 1PM","ANGUILLA 6PM","ANGUILLA 9PM"], map:{section:"special",id:"ny-race",draw:"R1"}}, /* placeholder */
    {k:["3.5.7","357","3-5-7"], map:{section:"special",id:"357",draw:"Main"}}
  ];
  function norm(s){ return s.toUpperCase().replace(/\s+/g," ").trim(); }
  function findTarget(label){
    const N=norm(label);
    for(const m of MAP){ if(m.k.some(k=>N.includes(k))) return m.map; }
    // Heuristics for lines like "Florida am", "Ct pm", etc.
    if(/NEW JERSEY\s+AM/i.test(label)) return {section:"usa",id:"nj",draw:"Midday"};
    if(/NEW JERSEY\s+PM/i.test(label)) return {section:"usa",id:"nj",draw:"Evening"};
    if(/CONNECT\s+AM/i.test(label)) return {section:"usa",id:"ct",draw:"Day"};
    if(/CONNECT\s+PM/i.test(label)) return {section:"usa",id:"ct",draw:"Night"};
    if(/^MIDDAY$/i.test(N)) return {section:"usa",id:"ny",draw:"Midday"};
    if(/^STATE$/i.test(N)) return {section:"usa",id:"ny",draw:"Evening"};
    return null;
  }

  /*************** Render public tiles ***************/
  function isOpen(d){ const now=new Date(); const [H,M]=d.time.split(":").map(Number); const [cH,cM]=minus20(d.time).split(":").map(Number); const nowM=now.getHours()*60+now.getMinutes(); const closeM=cH*60+cM; const today=now.getDay(); return nowM<closeM && d.days.includes(today); }
  function renderSection(key,title){
    const cat=loadCatalog(); const sec=document.createElement("div"); sec.className="section";
    sec.innerHTML=`<h2>${title}</h2><div class="grid"></div>`; const grid=sec.querySelector(".grid");
    const q=(document.getElementById("search")?.value||"").toLowerCase().trim();
    cat[key].forEach(l=>{
      if(!l.visible) return;
      if(q && !(l.name.toLowerCase().includes(q)||l.id.includes(q))) return;
      l.draws.forEach(d=>{
        const today=new Date().getDay(); if(!d.days.includes(today)) return;
        const r= (JSON.parse(localStorage.getItem(KEY_RESULTS)||"{}")[key]?.[l.id]?.[d.code]?.value) || "‚Äî";
        const card=document.createElement("div"); card.className="tile";
        const logo=logos[`${key}/${l.id}`];
        card.innerHTML=`
          <div class="badge">
            <div class="emblem">${logo? `<img src="${logo}" alt="">` : (l.id.slice(0,2).toUpperCase())}</div>
            <div class="name">${l.name}</div>
            <div class="pill">${d.code}</div>
          </div>
          <div class="nums">${r}</div>
          <div class="meta">
            <div>${i18n[lang].draw}: ${d.time}</div>
            <div>${i18n[lang].close}: ${minus20(d.time)}</div>
            <div class="status ${isOpen(d)?'':'closed'}">${isOpen(d)?i18n[lang].open:i18n[lang].closed}</div>
            <div style="justify-self:end">${l.tz||'ET'}</div>
          </div>`;
        grid.appendChild(card);
      });
    });
    return sec;
  }
  function render(){
    const content=document.getElementById("content"); content.innerHTML="";
    content.appendChild(renderSection("usa", i18n[lang].usa));
    content.appendChild(renderSection("rd", i18n[lang].rd));
    content.appendChild(renderSection("special", i18n[lang].special));
  }

  function td(t){ const d=document.createElement("td"); d.textContent=t; return d; }

  applyLang(); render();
  </script>
</body>
</html>
"""
with open("/mnt/data/beast_reader_v6.html","w",encoding="utf-8") as f:
    f.write(html)

print("Archivo creado: /mnt/data/beast_reader_v6.html")
