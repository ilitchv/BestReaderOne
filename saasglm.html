<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estrategia Venezuela - Sistema de Apuestas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .navbar {
            background-color: var(--dark-color);
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 4rem 0;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin-bottom: 2rem;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .alert {
            border-radius: 10px;
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table thead th {
            background-color: var(--dark-color);
            color: white;
        }
        
        .badge {
            font-size: 0.9em;
            padding: 0.5em 0.8em;
        }
        
        .stats-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            margin-bottom: 1.5rem;
        }
        
        .stats-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stats-card p {
            color: #6c757d;
            margin: 0;
        }
        
        .progression-table {
            font-size: 0.9rem;
        }
        
        .progression-table th {
            background-color: var(--dark-color);
            color: white;
        }
        
        .lottery-result {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0.2rem;
            border: 1px solid #dee2e6;
        }
        
        .lottery-position {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            font-weight: bold;
            margin: 0.1rem;
            font-size: 0.9rem;
        }
        
        .position-first {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .position-second {
            background-color: #d4edda;
            color: #155724;
        }
        
        .position-third {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .double-match {
            background-color: #fff3cd;
            color: #856404;
            font-weight: bold;
        }
        
        .no-match {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        @media (max-width: 768px) {
            .hero-section {
                padding: 2rem 0;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .stats-card h3 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-dice-3"></i> Estrategia Venezuela
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="homeLink">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="adminLink">Administrador</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="userLink">Panel de Usuario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logoutLink">Cerrar Sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <h1 class="display-4 fw-bold">Sistema de Apuestas Estratégicas</h1>
            <p class="lead">Implementación automatizada de la Estrategia Venezuela para Pick-3 y Pick-4</p>
            <div class="mt-4">
                <button class="btn btn-light btn-lg" id="registerBtn">
                    <i class="bi bi-person-plus"></i> Registrarse
                </button>
                <button class="btn btn-outline-light btn-lg ms-2" id="loginBtn">
                    <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión
                </button>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="container mb-5">
        <!-- Sección de Inicio -->
        <div id="homeSection" class="content-section">
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="bi bi-info-circle"></i> ¿Qué es la Estrategia Venezuela?</h2>
                        </div>
                        <div class="card-body">
                            <p>La Estrategia Venezuela es un sistema estadístico que opera sobre los juegos de lotería Pick-3 y Pick-4 de EE.UU.</p>
                            <p>La estrategia se basa en:</p>
                            <ul>
                                <li>Identificar "dobles" (números de dos dígitos iguales: 00, 11, 22, ..., 99)</li>
                                <li>Analizar tres posiciones por sorteo:
                                    <ul>
                                        <li><strong>Primera:</strong> últimos 2 dígitos del Pick-3</li>
                                        <li><strong>Segunda:</strong> primeros 2 dígitos del Pick-4</li>
                                        <li><strong>Tercera:</strong> últimos 2 dígitos del Pick-4</li>
                                    </ul>
                                </li>
                                <li>Utilizar un sistema de progresión de apuestas</li>
                                <li>Entrar en el mercado cuando se alcanza el P90 (percentil 90) de rachas</li>
                            </ul>
                            <div class="alert alert-info mt-3">
                                <i class="bi bi-lightbulb"></i> <strong>Consejo:</strong> La aplicación automatiza todo el proceso de análisis y te notifica cuando se cumplen las condiciones para operar.
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="bi bi-graph-up"></i> ¿Cómo Funciona?</h2>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="stats-card">
                                        <h3>1</h3>
                                        <p>Carga de Resultados</p>
                                        <small>El administrador carga los resultados de las loterías</small>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="stats-card">
                                        <h3>2</h3>
                                        <p>Análisis Automático</p>
                                        <small>El sistema calcula rachas y P90 por franja</small>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="stats-card">
                                        <h3>3</h3>
                                        <p>Alertas de Oportunidad</p>
                                        <small>Recibe notificaciones cuando gap ≥ P90</small>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="stats-card">
                                        <h3>4</h3>
                                        <p>Seguimiento de Apuestas</p>
                                        <small>Registra tus operaciones y resultados</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-speedometer2"></i> Estados Disponibles</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    New York
                                    <span class="badge bg-primary rounded-pill">4 franjas</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Florida
                                    <span class="badge bg-primary rounded-pill">4 franjas</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Texas
                                    <span class="badge bg-primary rounded-pill">4 franjas</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    California
                                    <span class="badge bg-primary rounded-pill">4 franjas</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Illinois
                                    <span class="badge bg-primary rounded-pill">4 franjas</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5><i class="bi bi-trophy"></i> Resultados Recientes</h5>
                        </div>
                        <div class="card-body">
                            <div id="recentResults">
                                <div class="text-center loading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Administrador -->
        <div id="adminSection" class="content-section hidden">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h2><i class="bi bi-gear"></i> Panel de Administrador</h2>
                            <button class="btn btn-sm btn-success" id="addResultBtn">
                                <i class="bi bi-plus-circle"></i> Agregar Resultado Manual
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h4>Cargar Resultados desde Archivo</h4>
                                    <p>Sube un archivo CSV o Excel con los resultados de las loterías.</p>
                                    <div class="mb-3">
                                        <label for="fileUpload" class="form-label">Seleccionar Archivo</label>
                                        <input class="form-control" type="file" id="fileUpload" accept=".csv,.xlsx,.xls">
                                    </div>
                                    <button class="btn btn-primary" id="uploadFileBtn">
                                        <i class="bi bi-upload"></i> Cargar Archivo
                                    </button>
                                    <div class="mt-3">
                                        <small class="text-muted">Formato esperado: Fecha, Estado, Franja, Pick3, Pick4</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h4>Estadísticas del Sistema</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="stats-card">
                                                <h3 id="totalResults">0</h3>
                                                <p>Resultados Cargados</p>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="stats-card">
                                                <h3 id="activeAlerts">0</h3>
                                                <p>Alertas Activas</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h4>Resultados Recientes</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Estado</th>
                                            <th>Franja</th>
                                            <th>Pick-3</th>
                                            <th>Pick-4</th>
                                            <th>Primera</th>
                                            <th>Segunda</th>
                                            <th>Tercera</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminResultsTable">
                                        <tr>
                                            <td colspan="9" class="text-center">No hay resultados cargados</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Usuario -->
        <div id="userSection" class="content-section hidden">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="bi bi-person-workspace"></i> Panel de Usuario</h2>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <h3 id="userBalance">$500</h3>
                                        <p>Balance Disponible</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <h3 id="activeBets">0</h3>
                                        <p>Apuestas Activas</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <h3 id="totalProfit">$0</h3>
                                        <p>Ganancias Totales</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <h3 id="winRate">0%</h3>
                                        <p>Tasa de Éxito</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-warning" id="noAlertsMessage">
                                <i class="bi bi-exclamation-triangle"></i> No hay alertas activas en este momento. Las alertas aparecerán cuando se cumplan las condiciones de entrada (gap ≥ P90).
                            </div>
                            
                            <div id="alertsContainer" class="mb-4">
                                <!-- Las alertas se cargarán dinámicamente aquí -->
                            </div>
                            
                            <h4>Resultados Recientes</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Estado</th>
                                            <th>Franja</th>
                                            <th>Pick-3</th>
                                            <th>Pick-4</th>
                                            <th>Primera</th>
                                            <th>Segunda</th>
                                            <th>Tercera</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userResultsTable">
                                        <tr>
                                            <td colspan="8" class="text-center">No hay resultados disponibles</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <h4 class="mt-4">Mis Apuestas</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Estado</th>
                                            <th>Franja</th>
                                            <th>Paso</th>
                                            <th>Stake</th>
                                            <th>Costo</th>
                                            <th>Resultado</th>
                                            <th>Ganancia</th>
                                            <th>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userBetsTable">
                                        <tr>
                                            <td colspan="9" class="text-center">No has realizado apuestas</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Registro -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registro de Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="registerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerInitialBalance" class="form-label">Balance Inicial ($)</label>
                            <input type="number" class="form-control" id="registerInitialBalance" min="100" value="500" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerMaxConcurrent" class="form-label">Máximo de Ciclos Concurrentes</label>
                            <select class="form-select" id="registerMaxConcurrent">
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="registerTerms">
                            <label class="form-check-label" for="registerTerms">
                                Acepto los términos y condiciones
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmRegisterBtn">Registrarse</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Inicio de Sesión -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Iniciar Sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="loginRemember">
                            <label class="form-check-label" for="loginRemember">
                                Recordar sesión
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmLoginBtn">Iniciar Sesión</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Agregar Resultado Manual -->
    <div class="modal fade" id="addResultModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Resultado Manual</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addResultForm">
                        <div class="mb-3">
                            <label for="resultDate" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="resultDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="resultState" class="form-label">Estado</label>
                            <select class="form-select" id="resultState" required>
                                <option value="">Seleccionar Estado</option>
                                <option value="NY">New York</option>
                                <option value="FL">Florida</option>
                                <option value="TX">Texas</option>
                                <option value="CA">California</option>
                                <option value="IL">Illinois</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="resultTime" class="form-label">Franja</label>
                            <select class="form-select" id="resultTime" required>
                                <option value="">Seleccionar Franja</option>
                                <option value="Midday">Midday</option>
                                <option value="Day">Day</option>
                                <option value="Evening">Evening</option>
                                <option value="Night">Night</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="resultPick3" class="form-label">Pick-3</label>
                            <input type="text" class="form-control" id="resultPick3" placeholder="Ej: 123" pattern="[0-9]{3}" maxlength="3" required>
                        </div>
                        <div class="mb-3">
                            <label for="resultPick4" class="form-label">Pick-4</label>
                            <input type="text" class="form-control" id="resultPick4" placeholder="Ej: 1234" pattern="[0-9]{4}" maxlength="4" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmAddResultBtn">Agregar Resultado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Apuesta -->
    <div class="modal fade" id="betModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Realizar Apuesta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h6>Información de la Oportunidad</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Estado:</strong></td>
                                    <td id="betState">-</td>
                                </tr>
                                <tr>
                                    <td><strong>Franja:</strong></td>
                                    <td id="betTime">-</td>
                                </tr>
                                <tr>
                                    <td><strong>Racha Actual (Gap):</strong></td>
                                    <td id="betGap">-</td>
                                </tr>
                                <tr>
                                    <td><strong>P90:</strong></td>
                                    <td id="betP90">-</td>
                                </tr>
                                <tr>
                                    <td><strong>Stake Sugerido:</strong></td>
                                    <td id="betStake">-</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Progresión de Apuestas</h6>
                            <table class="table table-sm progression-table">
                                <thead>
                                    <tr>
                                        <th>Paso</th>
                                        <th>Stake</th>
                                        <th>Costo</th>
                                        <th>Pago Primera</th>
                                    </tr>
                                </thead>
                                <tbody id="betProgressionTable">
                                    <!-- Se llenará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> Recuerda: Solo se reinicia el ciclo si hay un acierto en la posición "Primera". Los aciertos en "Segunda" y "Tercera" pagan pero no reinician el ciclo.
                    </div>
                    
                    <form id="betForm">
                        <input type="hidden" id="betStateHidden">
                        <input type="hidden" id="betTimeHidden">
                        <input type="hidden" id="betGapHidden">
                        <input type="hidden" id="betP90Hidden">
                        
                        <div class="mb-3">
                            <label for="betAmount" class="form-label">Monto a Apostar ($)</label>
                            <input type="number" class="form-control" id="betAmount" min="1" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="betNotes" class="form-label">Notas (Opcional)</label>
                            <textarea class="form-control" id="betNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmBetBtn">Realizar Apuesta</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Estrategia Venezuela</h5>
                    <p>Sistema automatizado para la implementación de la estrategia de apuestas en loterías Pick-3 y Pick-4.</p>
                </div>
                <div class="col-md-3">
                    <h5>Enlaces Rápidos</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Términos y Condiciones</a></li>
                        <li><a href="#" class="text-white">Política de Privacidad</a></li>
                        <li><a href="#" class="text-white">Soporte</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Contacto</h5>
                    <p>
                        <i class="bi bi-envelope"></i> info@estrategiavenezuela.com<br>
                        <i class="bi bi-telephone"></i> +1 (555) 123-4567
                    </p>
                </div>
            </div>
            <hr class="bg-white">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 Estrategia Venezuela. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simulación de base de datos con localStorage
        class Database {
            constructor() {
                this.initialize();
            }
            
            initialize() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('results')) {
                    localStorage.setItem('results', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('bets')) {
                    localStorage.setItem('bets', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('p90Data')) {
                    localStorage.setItem('p90Data', JSON.stringify({}));
                }
                
                if (!localStorage.getItem('gaps')) {
                    localStorage.setItem('gaps', JSON.stringify({}));
                }
                
                if (!localStorage.getItem('currentUser')) {
                    localStorage.setItem('currentUser', JSON.stringify(null));
                }
                
                // Cargar datos de ejemplo si no hay resultados
                const results = this.getResults();
                if (results.length === 0) {
                    this.loadSampleData();
                }
            }
            
            loadSampleData() {
                const sampleResults = [
                    { date: '2023-05-01', state: 'NY', time: 'Midday', pick3: '123', pick4: '1234' },
                    { date: '2023-05-01', state: 'NY', time: 'Evening', pick3: '456', pick4: '4567' },
                    { date: '2023-05-02', state: 'NY', time: 'Midday', pick3: '789', pick4: '7890' },
                    { date: '2023-05-02', state: 'NY', time: 'Evening', pick3: '112', pick4: '1122' },
                    { date: '2023-05-03', state: 'NY', time: 'Midday', pick3: '334', pick4: '3344' },
                    { date: '2023-05-03', state: 'NY', time: 'Evening', pick3: '556', pick4: '5566' },
                    { date: '2023-05-04', state: 'NY', time: 'Midday', pick3: '778', pick4: '7788' },
                    { date: '2023-05-04', state: 'NY', time: 'Evening', pick3: '990', pick4: '9900' },
                    { date: '2023-05-05', state: 'NY', time: 'Midday', pick3: '135', pick4: '1357' },
                    { date: '2023-05-05', state: 'NY', time: 'Evening', pick3: '246', pick4: '2468' },
                    { date: '2023-05-06', state: 'NY', time: 'Midday', pick3: '357', pick4: '3579' },
                    { date: '2023-05-06', state: 'NY', time: 'Evening', pick3: '468', pick4: '4680' },
                    { date: '2023-05-07', state: 'NY', time: 'Midday', pick3: '579', pick4: '5791' },
                    { date: '2023-05-07', state: 'NY', time: 'Evening', pick3: '680', pick4: '6802' },
                    { date: '2023-05-08', state: 'NY', time: 'Midday', pick3: '791', pick4: '7913' },
                    { date: '2023-05-08', state: 'NY', time: 'Evening', pick3: '802', pick4: '8024' },
                    { date: '2023-05-09', state: 'NY', time: 'Midday', pick3: '913', pick4: '9135' },
                    { date: '2023-05-09', state: 'NY', time: 'Evening', pick3: '024', pick4: '0246' },
                    { date: '2023-05-10', state: 'NY', time: 'Midday', pick3: '135', pick4: '1357' },
                    { date: '2023-05-10', state: 'NY', time: 'Evening', pick3: '246', pick4: '2468' },
                    { date: '2023-05-11', state: 'NY', time: 'Midday', pick3: '357', pick4: '3579' },
                    { date: '2023-05-11', state: 'NY', time: 'Evening', pick3: '468', pick4: '4680' },
                    { date: '2023-05-12', state: 'NY', time: 'Midday', pick3: '579', pick4: '5791' },
                    { date: '2023-05-12', state: 'NY', time: 'Evening', pick3: '680', pick4: '6802' },
                    { date: '2023-05-13', state: 'NY', time: 'Midday', pick3: '791', pick4: '7913' },
                    { date: '2023-05-13', state: 'NY', time: 'Evening', pick3: '802', pick4: '8024' },
                    { date: '2023-05-14', state: 'NY', time: 'Midday', pick3: '913', pick4: '9135' },
                    { date: '2023-05-14', state: 'NY', time: 'Evening', pick3: '024', pick4: '0246' },
                    { date: '2023-05-15', state: 'NY', time: 'Midday', pick3: '135', pick4: '1357' },
                    { date: '2023-05-15', state: 'NY', time: 'Evening', pick3: '246', pick4: '2468' },
                ];
                
                localStorage.setItem('results', JSON.stringify(sampleResults));
                this.calculateGaps();
                this.calculateP90();
            }
            
            getUsers() {
                return JSON.parse(localStorage.getItem('users'));
            }
            
            saveUser(user) {
                const users = this.getUsers();
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            getUserByEmail(email) {
                const users = this.getUsers();
                return users.find(user => user.email === email);
            }
            
            getCurrentUser() {
                return JSON.parse(localStorage.getItem('currentUser'));
            }
            
            setCurrentUser(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            getResults() {
                return JSON.parse(localStorage.getItem('results'));
            }
            
            saveResult(result) {
                const results = this.getResults();
                results.push(result);
                localStorage.setItem('results', JSON.stringify(results));
                this.calculateGaps();
                this.calculateP90();
            }
            
            deleteResult(index) {
                const results = this.getResults();
                results.splice(index, 1);
                localStorage.setItem('results', JSON.stringify(results));
                this.calculateGaps();
                this.calculateP90();
            }
            
            getBets() {
                return JSON.parse(localStorage.getItem('bets'));
            }
            
            saveBet(bet) {
                const bets = this.getBets();
                bets.push(bet);
                localStorage.setItem('bets', JSON.stringify(bets));
            }
            
            getUserBets(userId) {
                const bets = this.getBets();
                return bets.filter(bet => bet.userId === userId);
            }
            
            getP90Data() {
                return JSON.parse(localStorage.getItem('p90Data'));
            }
            
            saveP90Data(data) {
                localStorage.setItem('p90Data', JSON.stringify(data));
            }
            
            getGaps() {
                return JSON.parse(localStorage.getItem('gaps'));
            }
            
            saveGaps(data) {
                localStorage.setItem('gaps', JSON.stringify(data));
            }
            
            calculateGaps() {
                const results = this.getResults();
                const gaps = {};
                
                // Agrupar resultados por estado y franja
                const groupedResults = {};
                results.forEach(result => {
                    const key = `${result.state}-${result.time}`;
                    if (!groupedResults[key]) {
                        groupedResults[key] = [];
                    }
                    groupedResults[key].push(result);
                });
                
                // Ordenar resultados por fecha
                Object.keys(groupedResults).forEach(key => {
                    groupedResults[key].sort((a, b) => new Date(a.date) - new Date(b.date));
                });
                
                // Calcular gaps (rachas sin doble en Primera)
                Object.keys(groupedResults).forEach(key => {
                    const [state, time] = key.split('-');
                    const results = groupedResults[key];
                    
                    if (!gaps[state]) {
                        gaps[state] = {};
                    }
                    
                    if (!gaps[state][time]) {
                        gaps[state][time] = {
                            currentGap: 0,
                            history: []
                        };
                    }
                    
                    let currentGap = 0;
                    
                    results.forEach(result => {
                        const first = result.pick3.substring(1); // últimos 2 dígitos del Pick-3
                        const isDouble = first[0] === first[1];
                        
                        if (isDouble) {
                            if (currentGap > 0) {
                                gaps[state][time].history.push(currentGap);
                            }
                            currentGap = 0;
                        } else {
                            currentGap++;
                        }
                    });
                    
                    gaps[state][time].currentGap = currentGap;
                });
                
                this.saveGaps(gaps);
            }
            
            calculateP90() {
                const gaps = this.getGaps();
                const p90Data = {};
                
                Object.keys(gaps).forEach(state => {
                    p90Data[state] = {};
                    
                    Object.keys(gaps[state]).forEach(time => {
                        const gapData = gaps[state][time];
                        const history = gapData.history;
                        
                        if (history.length > 0) {
                            // Ordenar historial de gaps
                            const sortedHistory = [...history].sort((a, b) => a - b);
                            
                            // Calcular P90 (percentil 90)
                            const p90Index = Math.ceil(sortedHistory.length * 0.9) - 1;
                            const p90Value = sortedHistory[p90Index] || 0;
                            
                            p90Data[state][time] = p90Value;
                        } else {
                            p90Data[state][time] = 0;
                        }
                    });
                });
                
                this.saveP90Data(p90Data);
            }
            
            getActiveAlerts() {
                const gaps = this.getGaps();
                const p90Data = this.getP90Data();
                const alerts = [];
                
                Object.keys(gaps).forEach(state => {
                    Object.keys(gaps[state]).forEach(time => {
                        const currentGap = gaps[state][time].currentGap;
                        const p90 = p90Data[state][time];
                        
                        if (currentGap >= p90 && p90 > 0) {
                            alerts.push({
                                state,
                                time,
                                gap: currentGap,
                                p90
                            });
                        }
                    });
                });
                
                return alerts;
            }
            
            calculateSuggestedStake(user) {
                const balance = user.balance;
                const maxConcurrent = user.maxConcurrent;
                
                // Fórmula del manual: s ≈ ⌊Capital / (Colchón × C(1) × Ciclos)⌋
                // Donde C(1) = 10 × (1 - 1.70^5) / (1 - 1.70) ≈ 188.43
                const C1 = 188.43;
                const colchon = 1.2; // 20% de colchón
                
                const suggestedStake = Math.floor(balance / (colchon * C1 * maxConcurrent));
                
                // Asegurar un mínimo de $1
                return Math.max(1, suggestedStake);
            }
            
            calculateProgression(stake) {
                const progression = [];
                const multiplier = 1.7;
                const maxSteps = 5;
                
                for (let step = 1; step <= maxSteps; step++) {
                    const stepStake = stake * Math.pow(multiplier, step - 1);
                    const cost = 10 * stepStake; // 10 dobles
                    const payoutFirst = 55 * stepStake; // 55x por $1
                    
                    progression.push({
                        step,
                        stake: stepStake.toFixed(2),
                        cost: cost.toFixed(2),
                        payoutFirst: payoutFirst.toFixed(2)
                    });
                }
                
                return progression;
            }
        }
        
        // Clase principal de la aplicación
        class App {
            constructor() {
                this.db = new Database();
                this.currentUser = this.db.getCurrentUser();
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateUI();
                this.loadRecentResults();
                
                // Si hay un usuario logueado, ir al panel de usuario
                if (this.currentUser) {
                    this.showSection('userSection');
                }
            }
            
            setupEventListeners() {
                // Navegación
                document.getElementById('homeLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showSection('homeSection');
                });
                
                document.getElementById('adminLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showSection('adminSection');
                    this.loadAdminResults();
                });
                
                document.getElementById('userLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (this.currentUser) {
                        this.showSection('userSection');
                        this.loadUserData();
                    } else {
                        this.showLoginModal();
                    }
                });
                
                document.getElementById('logoutLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });
                
                // Botones de registro y login
                document.getElementById('registerBtn').addEventListener('click', () => {
                    this.showRegisterModal();
                });
                
                document.getElementById('loginBtn').addEventListener('click', () => {
                    this.showLoginModal();
                });
                
                // Formularios de registro y login
                document.getElementById('confirmRegisterBtn').addEventListener('click', () => {
                    this.register();
                });
                
                document.getElementById('confirmLoginBtn').addEventListener('click', () => {
                    this.login();
                });
                
                // Panel de administrador
                document.getElementById('addResultBtn').addEventListener('click', () => {
                    this.showAddResultModal();
                });
                
                document.getElementById('uploadFileBtn').addEventListener('click', () => {
                    this.uploadFile();
                });
                
                document.getElementById('confirmAddResultBtn').addEventListener('click', () => {
                    this.addResult();
                });
                
                // Panel de usuario
                document.getElementById('confirmBetBtn').addEventListener('click', () => {
                    this.placeBet();
                });
            }
            
            showSection(sectionId) {
                // Ocultar todas las secciones
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Mostrar la sección solicitada
                document.getElementById(sectionId).classList.remove('hidden');
                
                // Actualizar navegación
                document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                if (sectionId === 'homeSection') {
                    document.getElementById('homeLink').classList.add('active');
                } else if (sectionId === 'adminSection') {
                    document.getElementById('adminLink').classList.add('active');
                } else if (sectionId === 'userSection') {
                    document.getElementById('userLink').classList.add('active');
                }
            }
            
            updateUI() {
                // Actualizar estado de la UI según si hay un usuario logueado
                if (this.currentUser) {
                    document.getElementById('registerBtn').classList.add('hidden');
                    document.getElementById('loginBtn').classList.add('hidden');
                    document.getElementById('logoutLink').classList.remove('hidden');
                } else {
                    document.getElementById('registerBtn').classList.remove('hidden');
                    document.getElementById('loginBtn').classList.remove('hidden');
                    document.getElementById('logoutLink').classList.add('hidden');
                }
            }
            
            showRegisterModal() {
                const modal = new bootstrap.Modal(document.getElementById('registerModal'));
                modal.show();
            }
            
            showLoginModal() {
                const modal = new bootstrap.Modal(document.getElementById('loginModal'));
                modal.show();
            }
            
            showAddResultModal() {
                const modal = new bootstrap.Modal(document.getElementById('addResultModal'));
                
                // Establecer fecha actual por defecto
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('resultDate').value = today;
                
                modal.show();
            }
            
            showBetModal(alert) {
                const modal = new bootstrap.Modal(document.getElementById('betModal'));
                
                // Llenar información de la oportunidad
                document.getElementById('betState').textContent = alert.state;
                document.getElementById('betTime').textContent = alert.time;
                document.getElementById('betGap').textContent = alert.gap;
                document.getElementById('betP90').textContent = alert.p90;
                
                // Calcular stake sugerido
                const suggestedStake = this.db.calculateSuggestedStake(this.currentUser);
                document.getElementById('betStake').textContent = `$${suggestedStake}`;
                document.getElementById('betAmount').value = suggestedStake;
                
                // Guardar datos ocultos
                document.getElementById('betStateHidden').value = alert.state;
                document.getElementById('betTimeHidden').value = alert.time;
                document.getElementById('betGapHidden').value = alert.gap;
                document.getElementById('betP90Hidden').value = alert.p90;
                
                // Calcular y mostrar progresión
                const progression = this.db.calculateProgression(suggestedStake);
                const progressionTable = document.getElementById('betProgressionTable');
                progressionTable.innerHTML = '';
                
                progression.forEach(step => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${step.step}</td>
                        <td>$${step.stake}</td>
                        <td>$${step.cost}</td>
                        <td>$${step.payoutFirst}</td>
                    `;
                    progressionTable.appendChild(row);
                });
                
                modal.show();
            }
            
            register() {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const initialBalance = parseFloat(document.getElementById('registerInitialBalance').value);
                const maxConcurrent = parseInt(document.getElementById('registerMaxConcurrent').value);
                const termsAccepted = document.getElementById('registerTerms').checked;
                
                if (!name || !email || !password || !termsAccepted) {
                    alert('Por favor, completa todos los campos y acepta los términos y condiciones.');
                    return;
                }
                
                // Verificar si el usuario ya existe
                if (this.db.getUserByEmail(email)) {
                    alert('Ya existe una cuenta con ese correo electrónico.');
                    return;
                }
                
                // Crear nuevo usuario
                const user = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password, // En un entorno real, esto debería estar hasheado
                    balance: initialBalance,
                    maxConcurrent,
                    createdAt: new Date().toISOString()
                };
                
                this.db.saveUser(user);
                this.db.setCurrentUser(user);
                this.currentUser = user;
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                modal.hide();
                
                // Actualizar UI
                this.updateUI();
                this.showSection('userSection');
                this.loadUserData();
                
                alert('¡Registro exitoso! Bienvenido a Estrategia Venezuela.');
            }
            
            login() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    alert('Por favor, ingresa tu correo y contraseña.');
                    return;
                }
                
                // Buscar usuario
                const user = this.db.getUserByEmail(email);
                
                if (!user || user.password !== password) {
                    alert('Correo o contraseña incorrectos.');
                    return;
                }
                
                this.db.setCurrentUser(user);
                this.currentUser = user;
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                modal.hide();
                
                // Actualizar UI
                this.updateUI();
                this.showSection('userSection');
                this.loadUserData();
                
                alert(`¡Bienvenido de nuevo, ${user.name}!`);
            }
            
            logout() {
                this.db.setCurrentUser(null);
                this.currentUser = null;
                this.updateUI();
                this.showSection('homeSection');
                alert('Has cerrado sesión correctamente.');
            }
            
            uploadFile() {
                const fileInput = document.getElementById('fileUpload');
                
                if (!fileInput.files.length) {
                    alert('Por favor, selecciona un archivo.');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        // En un entorno real, aquí procesaríamos el archivo CSV o Excel
                        // Para este ejemplo, simularemos la carga de datos
                        
                        // Simular carga de datos
                        alert(`Archivo "${file.name}" cargado exitosamente. ${Math.floor(Math.random() * 50) + 10} resultados procesados.`);
                        
                        // Actualizar UI
                        this.loadAdminResults();
                        
                        // Resetear input
                        fileInput.value = '';
                    } catch (error) {
                        alert('Error al procesar el archivo. Por favor, verifica el formato.');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            }
            
            addResult() {
                const date = document.getElementById('resultDate').value;
                const state = document.getElementById('resultState').value;
                const time = document.getElementById('resultTime').value;
                const pick3 = document.getElementById('resultPick3').value;
                const pick4 = document.getElementById('resultPick4').value;
                
                if (!date || !state || !time || !pick3 || !pick4) {
                    alert('Por favor, completa todos los campos.');
                    return;
                }
                
                // Formatear Pick3 y Pick4 (asegurar ceros a la izquierda)
                const formattedPick3 = pick3.padStart(3, '0');
                const formattedPick4 = pick4.padStart(4, '0');
                
                // Crear resultado
                const result = {
                    date,
                    state,
                    time,
                    pick3: formattedPick3,
                    pick4: formattedPick4
                };
                
                // Guardar resultado
                this.db.saveResult(result);
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addResultModal'));
                modal.hide();
                
                // Actualizar UI
                this.loadAdminResults();
                
                alert('Resultado agregado exitosamente.');
            }
            
            placeBet() {
                const state = document.getElementById('betStateHidden').value;
                const time = document.getElementById('betTimeHidden').value;
                const gap = parseInt(document.getElementById('betGapHidden').value);
                const p90 = parseInt(document.getElementById('betP90Hidden').value);
                const amount = parseFloat(document.getElementById('betAmount').value);
                const notes = document.getElementById('betNotes').value;
                
                if (!amount || amount <= 0) {
                    alert('Por favor, ingresa un monto válido.');
                    return;
                }
                
                if (amount > this.currentUser.balance) {
                    alert('No tienes saldo suficiente para realizar esta apuesta.');
                    return;
                }
                
                // Crear apuesta
                const bet = {
                    id: Date.now().toString(),
                    userId: this.currentUser.id,
                    date: new Date().toISOString().split('T')[0],
                    state,
                    time,
                    gap,
                    p90,
                    step: 1,
                    stake: amount,
                    cost: 10 * amount, // 10 dobles
                    result: 'Pendiente',
                    payout: 0,
                    status: 'Activa',
                    notes
                };
                
                // Guardar apuesta
                this.db.saveBet(bet);
                
                // Actualizar balance del usuario
                this.currentUser.balance -= bet.cost;
                this.db.setCurrentUser(this.currentUser);
                
                // Actualizar usuarios en localStorage
                const users = this.db.getUsers();
                const userIndex = users.findIndex(u => u.id === this.currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = this.currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('betModal'));
                modal.hide();
                
                // Actualizar UI
                this.loadUserData();
                
                alert('Apuesta realizada exitosamente.');
            }
            
            loadRecentResults() {
                const results = this.db.getResults().slice(-5); // Últimos 5 resultados
                const container = document.getElementById('recentResults');
                
                if (results.length === 0) {
                    container.innerHTML = '<p class="text-center">No hay resultados disponibles</p>';
                    return;
                }
                
                container.innerHTML = '';
                
                results.forEach(result => {
                    const first = result.pick3.substring(1); // últimos 2 dígitos del Pick-3
                    const second = result.pick4.substring(0, 2); // primeros 2 dígitos del Pick-4
                    const third = result.pick4.substring(2); // últimos 2 dígitos del Pick-4
                    
                    const isDoubleFirst = first[0] === first[1];
                    const isDoubleSecond = second[0] === second[1];
                    const isDoubleThird = third[0] === third[1];
                    
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'mb-3';
                    resultDiv.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong>${result.state} - ${result.time}</strong>
                            <small>${result.date}</small>
                        </div>
                        <div class="lottery-result">${result.pick3}</div>
                        <div class="lottery-result">${result.pick4}</div>
                        <div class="mt-2">
                            <span class="lottery-position position-first ${isDoubleFirst ? 'double-match' : 'no-match'}">
                                Primera: ${first} ${isDoubleFirst ? '✓' : '✗'}
                            </span>
                            <span class="lottery-position position-second ${isDoubleSecond ? 'double-match' : 'no-match'}">
                                Segunda: ${second} ${isDoubleSecond ? '✓' : '✗'}
                            </span>
                            <span class="lottery-position position-third ${isDoubleThird ? 'double-match' : 'no-match'}">
                                Tercera: ${third} ${isDoubleThird ? '✓' : '✗'}
                            </span>
                        </div>
                    `;
                    
                    container.appendChild(resultDiv);
                });
            }
            
            loadAdminResults() {
                const results = this.db.getResults();
                const tableBody = document.getElementById('adminResultsTable');
                
                // Actualizar estadísticas
                document.getElementById('totalResults').textContent = results.length;
                document.getElementById('activeAlerts').textContent = this.db.getActiveAlerts().length;
                
                if (results.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="9" class="text-center">No hay resultados cargados</td></tr>';
                    return;
                }
                
                // Ordenar resultados por fecha (más recientes primero)
                const sortedResults = [...results].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                tableBody.innerHTML = '';
                
                sortedResults.forEach((result, index) => {
                    const first = result.pick3.substring(1); // últimos 2 dígitos del Pick-3
                    const second = result.pick4.substring(0, 2); // primeros 2 dígitos del Pick-4
                    const third = result.pick4.substring(2); // últimos 2 dígitos del Pick-4
                    
                    const isDoubleFirst = first[0] === first[1];
                    const isDoubleSecond = second[0] === second[1];
                    const isDoubleThird = third[0] === third[1];
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.date}</td>
                        <td>${result.state}</td>
                        <td>${result.time}</td>
                        <td>${result.pick3}</td>
                        <td>${result.pick4}</td>
                        <td><span class="badge ${isDoubleFirst ? 'bg-success' : 'bg-secondary'}">${first}</span></td>
                        <td><span class="badge ${isDoubleSecond ? 'bg-success' : 'bg-secondary'}">${second}</span></td>
                        <td><span class="badge ${isDoubleThird ? 'bg-success' : 'bg-secondary'}">${third}</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="app.deleteResult(${results.indexOf(result)})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            deleteResult(index) {
                if (confirm('¿Estás seguro de que quieres eliminar este resultado?')) {
                    this.db.deleteResult(index);
                    this.loadAdminResults();
                    alert('Resultado eliminado exitosamente.');
                }
            }
            
            loadUserData() {
                if (!this.currentUser) return;
                
                // Actualizar estadísticas del usuario
                document.getElementById('userBalance').textContent = `$${this.currentUser.balance.toFixed(2)}`;
                
                const userBets = this.db.getUserBets(this.currentUser.id);
                const activeBets = userBets.filter(bet => bet.status === 'Activa');
                const completedBets = userBets.filter(bet => bet.status !== 'Activa');
                
                document.getElementById('activeBets').textContent = activeBets.length;
                
                // Calcular ganancias totales
                const totalProfit = completedBets.reduce((sum, bet) => sum + (bet.payout - bet.cost), 0);
                document.getElementById('totalProfit').textContent = `$${totalProfit.toFixed(2)}`;
                
                // Calcular tasa de éxito
                const winningBets = completedBets.filter(bet => bet.result === 'Ganada');
                const winRate = completedBets.length > 0 ? (winningBets.length / completedBets.length) * 100 : 0;
                document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
                
                // Cargar alertas
                this.loadUserAlerts();
                
                // Cargar resultados recientes
                this.loadUserResults();
                
                // Cargar apuestas del usuario
                this.loadUserBets();
            }
            
            loadUserAlerts() {
                const alerts = this.db.getActiveAlerts();
                const container = document.getElementById('alertsContainer');
                const noAlertsMessage = document.getElementById('noAlertsMessage');
                
                if (alerts.length === 0) {
                    container.innerHTML = '';
                    noAlertsMessage.classList.remove('hidden');
                    return;
                }
                
                noAlertsMessage.classList.add('hidden');
                container.innerHTML = '';
                
                alerts.forEach(alert => {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-warning alert-dismissible fade show';
                    alertDiv.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Oportunidad de Apuesta!</strong> 
                                ${alert.state} - ${alert.time}: 
                                Racha actual (${alert.gap}) ≥ P90 (${alert.p90})
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="app.showBetModal(${JSON.stringify(alert).replace(/"/g, '&quot;')})">
                                Apostar
                            </button>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    `;
                    
                    container.appendChild(alertDiv);
                });
            }
            
            loadUserResults() {
                const results = this.db.getResults().slice(-10); // Últimos 10 resultados
                const tableBody = document.getElementById('userResultsTable');
                
                if (results.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No hay resultados disponibles</td></tr>';
                    return;
                }
                
                // Ordenar resultados por fecha (más recientes primero)
                const sortedResults = [...results].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                tableBody.innerHTML = '';
                
                sortedResults.forEach(result => {
                    const first = result.pick3.substring(1); // últimos 2 dígitos del Pick-3
                    const second = result.pick4.substring(0, 2); // primeros 2 dígitos del Pick-4
                    const third = result.pick4.substring(2); // últimos 2 dígitos del Pick-4
                    
                    const isDoubleFirst = first[0] === first[1];
                    const isDoubleSecond = second[0] === second[1];
                    const isDoubleThird = third[0] === third[1];
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.date}</td>
                        <td>${result.state}</td>
                        <td>${result.time}</td>
                        <td>${result.pick3}</td>
                        <td>${result.pick4}</td>
                        <td><span class="badge ${isDoubleFirst ? 'bg-success' : 'bg-secondary'}">${first}</span></td>
                        <td><span class="badge ${isDoubleSecond ? 'bg-success' : 'bg-secondary'}">${second}</span></td>
                        <td><span class="badge ${isDoubleThird ? 'bg-success' : 'bg-secondary'}">${third}</span></td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            loadUserBets() {
                const userBets = this.db.getUserBets(this.currentUser.id);
                const tableBody = document.getElementById('userBetsTable');
                
                if (userBets.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="9" class="text-center">No has realizado apuestas</td></tr>';
                    return;
                }
                
                // Ordenar apuestas por fecha (más recientes primero)
                const sortedBets = [...userBets].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                tableBody.innerHTML = '';
                
                sortedBets.forEach(bet => {
                    let statusBadge = '';
                    if (bet.status === 'Activa') {
                        statusBadge = '<span class="badge bg-warning">Activa</span>';
                    } else if (bet.result === 'Ganada') {
                        statusBadge = '<span class="badge bg-success">Ganada</span>';
                    } else {
                        statusBadge = '<span class="badge bg-danger">Perdida</span>';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${bet.date}</td>
                        <td>${bet.state}</td>
                        <td>${bet.time}</td>
                        <td>${bet.step}</td>
                        <td>$${bet.stake.toFixed(2)}</td>
                        <td>$${bet.cost.toFixed(2)}</td>
                        <td>${bet.result}</td>
                        <td>$${bet.payout.toFixed(2)}</td>
                        <td>${statusBadge}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Inicializar la aplicación
        const app = new App();
    </script>
</body>
</html>
